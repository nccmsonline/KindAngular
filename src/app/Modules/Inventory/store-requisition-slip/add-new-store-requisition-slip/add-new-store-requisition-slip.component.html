<div class="preloader" style="display: none;">
    <div class="lds-ripple">
        <div class="lds-pos"></div>
        <div class="lds-pos"></div>
    </div>
</div>
<div id="main-wrapper" data-theme="light" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed" data-boxed-layout="full">
<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="page-wrapper" >
    <div class="container-fluid" style="background:#dcdcdc;">
<form>
        <div class="example-loading-shade" *ngIf="isLoadingResults ">
                <mat-spinner  [diameter]="40" *ngIf="isLoadingResults"></mat-spinner>
            </div>
            <div class="example-loading-shade" *ngIf="isLoadingResults ">
                    <mat-spinner  [diameter]="60" *ngIf="isLoadingResults"></mat-spinner>
                </div>
    <div class="row">
        <div class="col-12">
            <div class="card" style="border-top: 2px solid #0e43af;box-shadow:0 1px 3px rgba(0,0,0,.3);" >
                <div class="card-body border-bottom py-2">
                    <div class="d-md-flex align-items-center justify-content-between">
                        <div class="d-flex">
                            <a skipLocationChange  [routerLink]="['/store-requisition']" class="btn btn-sm rounded btn-warning mr-3" title="Back to Orders"><i
                                    class="mdi mdi-keyboard-backspace"></i></a>
                            <h4 class="modal-title " id="exampleModalLabel">{{'requisitionslip' | translate}}</h4>
                        </div>
                        <!-- <div>
                            
                            <button class="btn btn-sm btn-primary rounded"><i class="mdi mdi-content-save"></i>&nbsp;Save</button>
                            <button class="btn btn-sm btn-primary rounded"><i class="mdi mdi-content-save-all"></i>&nbsp;Apply Changes</button>
                        </div> -->
                    </div>
                </div>
                <div class="d-flex- row">
                    <div class="col-lg-12 tab-content m-t-10" id="pills-tabContent">
                        <div class="card-body purchase-order px-0 py-2">

                            <div class="form-inline">
                                        <div class="form-group row col-4 mb-2">
                                            <label class="col-sm-4 text-right">{{'reqslipno' | translate}}</label>
                                            <div class="col-sm-8">
                                                <input class="form-control w-100  form-control-sm readonly-disable" name="REQNO" [readonly]="true" [(ngModel)]="newData.REQNO"
                                                [ngModelOptions]="{standalone: true}">
                                            </div>
                                        </div>
                                        <div class="form-group row col-4 mb-2">
                                                <label class="col-sm-4 text-right">{{'date' |translate}}</label>
                                                <div class="col-sm-8">
                                                    <mat-form-field class="form-control w-100 mat-form-field-date-picker">
                                                        <input matInput [matDatepicker]="rdate" name="REQDATE" [(ngModel)]="newData.REQDATE" [ngModelOptions]="{standalone: true}">
                                                        <!-- <input class="form-control w-100 form-control-sm" name="reqndate" [(ngModel)]="newData.reqndate" [ngModelOptions]="{standalone: true}" disabled> -->
                                                        <mat-datepicker-toggle matSuffix [for]="rdate"></mat-datepicker-toggle>
                                                        <mat-datepicker #rdate ></mat-datepicker>
                                                    </mat-form-field>
                                                </div>
                                        </div>
                                        <div class="form-group row col-4 mb-2">
                                            <label class="col-sm-4 text-right">{{'manualslipno' |translate}}</label>
                                            <div class="col-sm-8">
                                                <input class="form-control w-100  form-control-sm" name="ACTUALSLIPNO" [(ngModel)]="newData.ACTUALSLIPNO"
                                                maxlength="10"  [ngModelOptions]="{standalone: true}">
                                            </div>
                                        </div>
                                        <div class="form-group row col-4 mb-2">
                                            <label class="col-sm-4 text-right error-control-label required">{{'department' |
                                                translate}}</label>
                                            <div class="col-sm-8">
                                                <ngx-select class="ngx-custom-select-dropdown"
                                                [ngModelOptions]="{standalone: true}" name="deptid" [allowClear]="true"
                                                    [(ngModel)]="newData.DEPTID" [items]="departmentget" optionValueField="DEPTID"
                                                    optionTextField="DEPTNAME" placeholder="{{'selectdepartment' | translate}}">
                                                </ngx-select>
                                            </div>
                                        </div>
                                        <div class="form-group row col-4 mb-2">
                                            <label class="col-sm-4 text-right error-control-label required">{{'costcentre' |
                                                translate}}</label>
                                            <div class="col-sm-8">
                                                <ngx-select class="ngx-custom-select-dropdown" [ngModelOptions]="{standalone: true}"
                                                    name="COSTCENTERID" [allowClear]="true" [(ngModel)]="newData.COSTCENTERID"
                                                    [items]="costcentreget" optionValueField="COSTCENTERID" optionTextField="COSTCENTRE"
                                                    placeholder="{{'selectcostcentre' | translate}}">
                                                </ngx-select>
                                            </div>
                                        </div>
                                        <div class="form-group row col-4 mb-2">
                                            <label class="col-sm-4 text-right error-control-label required">{{'store'|
                                                translate}}</label>
                                            <div class="col-sm-8">
                                                <ngx-select class="ngx-custom-select-dropdown ngx-custom-select-dropdown-text-wrap" [ngModelOptions]="{standalone: true}" name="STOREID"
                                                    [allowClear]="true" [(ngModel)]="newData.STOREID" [items]="storeget"
                                                    optionValueField="STOREID" optionTextField="STORE" placeholder="{{'selectstore' | translate}}">
                                                </ngx-select>
                                            </div>
                                        </div>
                                        <div class="form-group row col-4 mb-2">
                                                <label class="col-sm-4 text-right "  >{{'ipono' | translate}}</label>
                                                <div class="col-sm-8 d-flex">
                                                    <ngx-select class="ngx-custom-select-dropdown ngx-custom-select-dropdown-text-wrap"  (ngModelChange)="onIPONOo($event,newData)" 
                                                    name="IPOID"   [ngModelOptions]="{standalone: true}" [allowClear]="true" [(ngModel)]="newData.IPOID" [disabled]="!isbranch3"
                                                    [items]="ipoList" optionValueField="IPOID" optionTextField="IPONO" placeholder=" Select  IIPO"  >
                                                    </ngx-select>
                                                </div>
                                        </div>
                                        <div class="form-group row col-8 mb-1">
                                                <label class="col-sm-2 text-right " >{{'product' | translate}}</label>
                                                <div class="col-sm-9">
                                                    <ngx-select class="ngx-custom-select-dropdown ngx-custom-category-select ngx-custom-select-dropdown-text-wrap" 
                                                    (ngModelChange)="getOnChangeProduct($event, newData)" [ngModelOptions]="{standalone: true}" 
                                                    [allowClear]="true" [(ngModel)]="newData.PRODUCTID" [items]="itemlistgetDesc" optionValueField="ITEMID"  [disabled]="!isbranch3"
                                                    optionTextField="ITEMNAME" placeholder=" Select  Product Name"  >
                                                    </ngx-select>
                                                </div>
                                        </div>
                                        <div class="form-group row col-4 mb-2">
                                                    <label class="col-sm-4 text-right "  >{{'batchsize' | translate}}</label>
                                            <div class="col-sm-8">
                                            <input style="text-align:right" type="text" class="form-control w-100"  [(ngModel)]="newData.NOOFSETS"   [disabled]="!isbranch3"
                                            [ngModelOptions]="{standalone: true}"  (keyup)="getBomComponentDetail(newData)" 
                                            oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');">
                                            </div>
                                        </div>
                            </div>

                        </div>
                    </div>

                    <div class="col-lg-12">
                        <h4 style="padding-top:10px; margin-left: 5px;">{{'detailofitem'| translate}}</h4>
                        <div class="table-scroll mx-1">
                        <div class="card-body border-top store-requisition px-0 py-2">
                                <table class="table table-striped custom-table custom-table-big custom-table-big tr th ">
                                    <thead>
                                        <tr style="background-color: #666666; color: #ffffff;">
                                            <th scope="col" style="width:5%;">{{'sr' | translate}}</th>
                                            <th scope="col" style="width:10%;">{{'itemcode' | translate}}</th>
                                            <th scope="col" style="width:25%;">{{'itemname' | translate}}</th>
                                            <th scope="col" style="width:8%;text-align: right;">{{'stock' | translate}}</th>
                                            <th scope="col" style="width:8%;">{{'unit' | translate}}</th>
                                            <th scope="col" style="width:7%;text-align: right;">{{'resqty' | translate}}</th>
                                            <th scope="col" style="width:10%;" class="text-right">{{'requestedqty' | translate}}</th>
                                            <th scope="col" style="width:20%;">{{'remarks' | translate}}</th>
                                            <th scope="col" style="width:5%;text-align: center;">{{'action' |translate}}</th>
                                        </tr>
                                    </thead>
                                    <tbody class="font-sm">
                                            <tr>
                                                   <td></td>
                                                  
                                                    <td class="pl-1 pr-0">
                                                        <input #codefocus type="text" class="form-control w-100" [(ngModel)]="newitem.ITEMCODE"  (keyup)="searchItemCode($event.target.value, newitem)"  [ngModelOptions]="{standalone: true}">
                                                        <div *ngIf="itemCodeDesc != ''" class="search-list-header">
                                                                <div class="example-loading-shade" *ngIf="isLoadingItemCode">
                                                                    <mat-spinner  [diameter]="20" *ngIf="isLoadingItemCode"></mat-spinner>
                                                                </div>
                                                                
                                    
                                                                  <table id="selectedValue" class="table table-condensed table-striped table-hover">
                                                                    <tr class="ui-menu-item" role="menuitem" style="height: 40px;">
                                                                        <th style="width: 200px;height: 40px;">Item Code</th>
                                                                        <th style="width: 500px;height: 40px;">Item Name</th>
                                                                   </tr>
                                                                    <tr class="ui-menu-item" role="menuitem" *ngFor="let result of itemlistget"
                                                                      (click)="onChangeOfItemCode(result, newitem)">
                                                                      <td>{{ result.ITEMCODE }}</td>
                                                                      <td>{{ result.ITEMNAME }}</td>
                                                                      
                                                                    </tr>
                                                                  </table>
                                                              
                                                            </div>
                                                    </td>
                                                    <td class="pl-1 pr-0">
                                                        <input type="text" class="form-control w-100" [(ngModel)]="newitem.ITEMNAME"  (keyup)="searchItemName($event.target.value, newitem)"  [ngModelOptions]="{standalone: true}">
                                                        <div *ngIf="itemNameDesc != ''" class="search-list-header">
                                                                <div class="example-loading-shade" *ngIf="isLoadingItemName">
                                                                    <mat-spinner  [diameter]="20" *ngIf="isLoadingItemName"></mat-spinner>
                                                                </div>
                                                                
                                    
                                                                  <table id="selectedValue" class="table table-condensed table-striped table-hover">
                                                                    <tr class="ui-menu-item" role="menuitem" style="height: 40px;">
                                                                        <th style="width: 200px;height: 40px;">Item Code</th>
                                                                        <th style="width: 500px;height: 40px;">Item Name</th>
                                                                   </tr>
                                                                    <tr class="ui-menu-item" role="menuitem" *ngFor="let result of itemlistget"
                                                                      (click)="onChangeOfItemName(result, newitem)">
                                                                      <td>{{ result.ITEMCODE }}</td>
                                                                      <td>{{ result.ITEMNAME }}</td>
                                                                      
                                                                    </tr>
                                                                  </table>
                                                              
                                                            </div>
                                                    </td>

                                                    <td *ngIf="newitem.STOCKINHAND > 0" style="text-align: right;cursor: pointer;text-decoration: underline;color: #0e43af;" >{{newitem.STOCKINHAND | number : '1.3-3'}}</td>
                                                    <td *ngIf="newitem.STOCKINHAND <= 0" style="text-align: right;color: red;">{{newitem.STOCKINHAND | number : '1.3-3'}}</td>
                                                    <td *ngIf="newitem.STOCKINHAND == undefined || newitem.STOCKINHAND == null" style="text-align: right;"></td>
                                                    <td><input type="text" class="form-control w-100 readonly-disable" [(ngModel)]='newitem.UOM' [readonly]="true"
                                                            [ngModelOptions]="{standalone: true}"></td>
                                                    <td style="text-align: right;cursor: pointer;text-decoration: underline;color: #0e43af;" >{{newitem.QUANTITYISSUED}}</td>
                                                    <td>
                                                        <input type="text" class="form-control w-100 text-right" [(ngModel)]="newitem.QUANTITYREQUESTED"
                                                        oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"  [ngModelOptions]="{standalone: true}">
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control w-100" [(ngModel)]="newitem.REMARKS"
                                                           [ngModelOptions]="{standalone: true}">
                                                    </td>
                                                    <td style="width:60px;text-align: center;">
                                                        <i (click)="additem()" class="fas fa-plus"></i>
                                                    </td>
                                                </tr>
                                        <tr *ngFor="let item of items ; let i = index">
                                            <td>{{item.sr}}</td>
                                            <td *ngIf="item.id === edititemID">
                                          <input type="text" class="form-control w-100" [(ngModel)]='item.ITEMCODE'  (keyup)="searchItemCode($event.target.value, item)" [ngModelOptions]="{standalone: true}">
                                          <div *ngIf="itemCodeDesc != ''" class="search-list-header">
                                                <div class="example-loading-shade" *ngIf="isLoadingItemCode">
                                                    <mat-spinner  [diameter]="20" *ngIf="isLoadingItemCode"></mat-spinner>
                                                </div>
                                                
                    
                                                  <table id="selectedValue" class="table table-condensed table-striped table-hover">
                                                    <tr class="ui-menu-item" role="menuitem" style="height: 40px;">
                                                        <th style="width: 200px;height: 40px;">Item Code</th>
                                                        <th style="width: 500px;height: 40px;">Item Name</th>
                                                   </tr>
                                                    <tr class="ui-menu-item" role="menuitem" *ngFor="let result of itemlistget"
                                                      (click)="onChangeOfItemCode(result, item)">
                                                      <td>{{ result.ITEMCODE }}</td>
                                                      <td>{{ result.ITEMNAME }}</td>
                                                      
                                                    </tr>
                                                  </table>
                                              
                                            </div>
                                       </td>
                                      <td *ngIf="item.id !== edititemID" >{{item.ITEMCODE}}</td>
      
                                      <td *ngIf="item.id === edititemID">
                                            <input type="text" class="form-control w-100" [(ngModel)]='item.ITEMNAME'  (keyup)="searchItemName($event.target.value, item)" [ngModelOptions]="{standalone: true}">
                                            <div *ngIf="itemNameDesc != ''" class="search-list-header">
                                                    <div class="example-loading-shade" *ngIf="isLoadingItemName">
                                                        <mat-spinner  [diameter]="20" *ngIf="isLoadingItemName"></mat-spinner>
                                                    </div>
                                                    
                        
                                                      <table id="selectedValue" class="table table-condensed table-striped table-hover">
                                                        <tr class="ui-menu-item" role="menuitem" style="height: 40px;">
                                                            <th style="width: 200px;height: 40px;">Item Code</th>
                                                            <th style="width: 500px;height: 40px;">Item Name</th>
                                                       </tr>
                                                        <tr class="ui-menu-item" role="menuitem" *ngFor="let result of itemlistget"
                                                          (click)="onChangeOfItemName(result, item)">
                                                          <td>{{ result.ITEMCODE }}</td>
                                                          <td>{{ result.ITEMNAME }}</td>
                                                          
                                                        </tr>
                                                      </table>
                                                  
                                                </div>
                                      </td>
                                      <td *ngIf="item.id !== edititemID" >{{item.ITEMNAME}}</td>
                                            <td *ngIf="item.STOCKINHAND > 0" style="text-align: right;cursor: pointer;text-decoration: underline;color: #0e43af;">{{item.STOCKINHAND | number : '1.3-3'}}</td>
                                            <td *ngIf="item.STOCKINHAND <= 0" style="text-align: right;color: red;">{{item.STOCKINHAND | number : '1.3-3'}}</td>
                                            <!-- <td *ngIf="item.STOCKINHAND == 0" style="text-align: right;">{{item.STOCKINHAND | number : '1.3-3'}}</td> -->
                                            <td *ngIf="item.STOCKINHAND == undefined || item.STOCKINHAND == null" style="text-align: right;"></td>
                                            <td *ngIf="item.id == edititemID"><input type="text" class="form-control w-100 readonly-disable" [readonly]="true"
                                                    [(ngModel)]='item.UOM' [ngModelOptions]="{standalone: true}"></td>
                                            <td *ngIf="item.id != edititemID" (dblclick)="edititem(item.id)">{{item.UOM}}</td>
                                            <td (dblclick)="edititem(item.id)" style="text-align: right;">{{item.QUANTITYISSUED}}</td>
                                            <td *ngIf="item.id === edititemID"><input type="text" class="form-control w-100 text-right" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"
                                                    [(ngModel)]='item.QUANTITYREQUESTED' [ngModelOptions]="{standalone: true}"></td>
                                            <td *ngIf="item.id !== edititemID" (dblclick)="edititem(item.id)" class="text-right">{{item.QUANTITYREQUESTED }}</td>
                                            <td  *ngIf="item.id === edititemID"><input type="text"
                                                    class="form-control w-100" (keyup.enter)="updateitem(item)" [(ngModel)]='item.REMARKS'
                                                    [ngModelOptions]="{standalone: true}"></td>
                                            <td *ngIf="item.id !== edititemID" (dblclick)="edititem(item.id)">{{item.REMARKS
                                                | titlecase}}</td>
                                            <td style="width:60px;text-align: center;">
                                                <div>
                                                    <i *ngIf="item.id === edititemID" class="fas fa-check customIcon"
                                                        (click)="updateitem(item)"></i>
                                                    <i *ngIf="item.id !== edititemID" class="fas fa-edit customIcon"
                                                        (click)="edititem(item.id)"></i>
                                                    <i style="margin-left: 5px;" class="far fa-trash-alt customIcon"
                                                        (click)="removeitem(i)"></i>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>

                                </table>
                                <ng-container *ngIf="show == true" >
                                    <p><span style="color:red;">{{'pleaseenterdetails' | translate}}</span> </p>
                                </ng-container>
                        </div>
                        </div>

                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-secondary rounded bg-danger" skipLocationChange routerLink="/store-requisition">{{'cancel' |
                        translate}}</button>
                    &nbsp;
                    <button *ngIf="action == 'new'" [disabled]='isLoadingResults' type="button" class="btn btn-sm btn-info rounded" (click)="validateBeforeSave(newData, 'Insert')">{{'save' | translate}}</button>
                    <button *ngIf="action == 'edit' && newData.CONFIRM=='N'" [disabled]='isLoadingResults' type="button" class="btn btn-sm btn-info rounded" (click)="validateBeforeSave(newData, 'Update')">{{'update'|translate}}</button>
                    <button *ngIf="action == 'edit' && newData.CONFIRM=='N' && isStoreUser=='Y'" type="button" class="btn btn-sm btn-success rounded" (click)="confirmewquiisition(newData, 'Update')">{{'confirm'|translate}}</button>
                </div>
            </div>
        </div>

    </div>
</form>
<app-footer></app-footer>
    </div>
</div>
</div>