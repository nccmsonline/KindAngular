<!-- used for font weight 600 as per user requirement  -->
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;0,700;1,300&display=swap"
    rel="stylesheet">
<!-- end -->
<div class="preloader" style="display: none;">
    <div class="lds-ripple">
        <div class="lds-pos"></div>
        <div class="lds-pos"></div>
    </div>
</div>
<div id="main-wrapper" data-theme="light" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed" data-boxed-layout="full">
    <app-header></app-header>
    <app-sidebar></app-sidebar>

    <div class="page-wrapper">
        <div class="container-fluid" style="background:#dcdcdc;">
            <form [formGroup]="requisitionform" novalidate autocomplete="off">
                <div class="example-loading-shade" *ngIf="isLoadingResults ">
                    <mat-spinner [diameter]="40" *ngIf="isLoadingResults"></mat-spinner>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="card" style="border-top: 2px solid #0e43af;box-shadow:0 1px 3px rgba(0,0,0,.3);" (click)="dropdownHide()">
                            <div class="card-body border-bottom py-2 d-flex">
                                <div class="col-md-12 ">
                                    <div class="form-inline">
                                        <div class="col-md-10 d-md-flex align-items-center justify-content-between">
                                            <div class="d-flex">
                                              

                                                <h4 class="modal-title " id="exampleModalLabel">
                                                    {{'uniqueitemcodificationmapping' | translate}}</h4>
                                            </div>
                                        </div>
                                       <div class="form-group row col-md-2 align-items-center"> 
                                                <button type="button" (click)="opendialog(newData)"
                                                    class="btn btn-sm btn-info rounded " 
                                                    [disabled]="newData.unit==null || newData.unit==undefined || newData.unit== '' || newData.PARENTITEMID==null || newData.PARENTITEMID==undefined || newData.PARENTITEMID== '' ">View + Un-confirm mapping</button>
                                            </div> 
                                      
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex- row">
                                <div class="col-md-12 tab-content m-t-10" id="pills-tabContent">


                                    <div class="card-body border-bottom purchase-order px-0 py-2">
                                        <div class="example-loading-shade" *ngIf="isLoadingResults3 ">
                                            <mat-spinner [diameter]="40" *ngIf="isLoadingResults3"></mat-spinner>
                                        </div>
                                        <div class="form-inline">
                                            <div class="form-group row col-md-5 mb-2">
                                                <label class="col-md-4 text-right  error-control-label required">{{'parentunit'
                                                    |translate}}</label>
                                                <div class="col-md-5">
                                                    <ngx-select
                                                        class="ngx-custom-select-dropdown ngx-custom-select-dropdown-text-wrap "
                                                        [ngModelOptions]="{standalone: true}" name="unit"
                                                        [(ngModel)]="newData.unit"
                                                        [items]="parentunitarray" optionValueField="BRANCHID"
                                                        optionTextField="BRANCHNAME"
                                                        placeholder="{{'pleaseselect' | translate}}">
                                                    </ngx-select>
                                                </div>
                                            </div>
                                            <div class="col-md-5 form-group row">

                                                <label class="col-md-3 text-right error-control-label required">{{'childunit' |translate}}</label>
                                                <div class="col-md-5">
                                                    <ngx-select class="ngx-custom-select-dropdown ngx-custom-select-dropdown-text-wrap "
                                                        [ngModelOptions]="{standalone: true}" name="unit" [(ngModel)]="newData.childunit"
                                                        [items]="parentunitarray" optionValueField="BRANCHID" optionTextField="BRANCHNAME"
                                                        placeholder="{{'pleaseselect' | translate}}" (select)="onChangeChildUnit($event)">
                                                    </ngx-select>
                                                </div>
                                            </div>
                                            <div class="col-md-2"></div>
                                            <div class="form-group row col-md-5 mb-2">
                                                <label class="col-md-4 text-right  error-control-label required">{{'parentitem'
                                                    |translate}}</label>
                                                <div class="col-md-8">
                                                    <input
                                                        [readonly]="newData.unit==null || newData.unit==undefined || newData.unit== '' "
                                                        (keyup)="searchTermItemNew($event.target.value, newData)"
                                                        name="ITEMNAME" [(ngModel)]='newData.parentitemname'
                                                        [ngModelOptions]="{standalone: true}" style="padding-right:25px;"
                                                        [value]="newData.parentitemname || ''" autocomplete="off"
                                                        class="w-100 form-control error-border form-control-sm">
                                                        <button class="close-icon" style="position: absolute; top: 8px;"
                                                        (click)="reset(newData)"></button>
                                                    <div *ngIf="arrayItem != ''" class="search-list-supplier">
                                                        <table id="selectedValue"
                                                            class="table table-condensed table-striped table-hover">
                                                            <div class="example-loading-shade" *ngIf="isLoadingResults1 ">
                                                                <mat-spinner [diameter]="30" *ngIf="isLoadingResults1"></mat-spinner>
                                                            </div>
                                                            <tr class="ui-menu-item" role="menuitem">
                                                                <th style="padding-left: 0;">{{'itemname' | translate}}</th>
                                                                <th style="padding-left: 0;">{{'itemcode' | translate}}</th>
                                                                <th style="padding-left: 0;">{{'uom' | translate}}</th>
                                                                <th class="text-right" style="padding-right: 0;">{{'stock' | translate}}</th>
                                                            </tr>
                                                            <tr class="ui-menu-item" role="menuitem"
                                                                *ngFor="let result of itemlistget"
                                                                (click)="onChangeOfItem(result.ITEMID, newData)">
                                                                <td>{{ result.ITEMNAME }}</td>
                                                                <td>{{ result.ITEMCODE }}</td>
                                                                <td>{{ result.UOM }}</td>
                                                                <td  class="text-right">{{ result.STOCK | number : '1.3-3'}}</td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="form-group row col-md-5 mb-2">
                                                <label class="col-md-3 text-right  error-control-label required">{{'childitem'
                                                    |translate}}</label>
                                                <div class="col-md-8">
                                                    <input
                                                        [readonly]="newData.childunit==null || newData.childunit==undefined || newData.childunit== '' "
                                                        (keyup)="searchTermItemNew1($event.target.value, newData)"
                                                        name="ITEMNAME" [(ngModel)]='newData.childitemname'
                                                        [ngModelOptions]="{standalone: true}"
                                                        [value]="newData.childitemitemname || ''" autocomplete="off"
                                                        class="w-100 form-control error-border form-control-sm">
                                                    <div *ngIf="arrayItem1 != ''" class="search-list-supplier" style="max-width: 520px;">
                                                        <table id="selectedValue"
                                                            class="table table-condensed table-striped table-hover">
                                                            <div class="example-loading-shade" *ngIf="isLoadingResults2 ">
                                                                <mat-spinner [diameter]="30" *ngIf="isLoadingResults2"></mat-spinner>
                                                            </div>
                                                            <tr class="ui-menu-item" role="menuitem">
                                                                <th style="padding-left: 0;">{{'itemname' | translate}}</th>
                                                                <th style="padding-left: 0;">{{'itemcode' | translate}}</th>
                                                                <th style="padding-left: 0;">{{'uom' | translate}}</th>
                                                                <th  class="text-right" style="padding-right: 0;">{{'stock' | translate}}</th>
                                                            </tr>
                                                            <tr class="ui-menu-item" role="menuitem"
                                                                *ngFor="let result of itemlistget"
                                                                (click)="onChangeOfItem1(result)">
                                                                <td>{{ result.ITEMNAME }}</td>
                                                                <td>{{ result.ITEMCODE }}</td>
                                                                <td>{{ result.UOM }}</td>
                                                                <td  class="text-right">{{ result.STOCK | number : '1.3-3'}}</td>

                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="scroll-spy pb-3 pl-1" style="height:350px;overflow-y: scroll;max-height:350px;" id="parentDiv" scrollSpy>
                                            <div class="card-body border-top supplier-category-master px-0 py-0">
                                                <div >
                                                    <table class="table table-striped custom-table tr th">
                                                        <thead>
                                                            <tr style="background-color: #666666; color: #ffffff;">
                                                                <th scope="col" style="width:4%;"></th>
                                                                <th scope="col" style="width:12%;">{{'unit' | translate}}</th>
                                                                <th scope="col" style="width:38%;">{{'childitemname' | translate}}</th>
                                                                <!-- <th scope="col" style="width:10%;">{{'oldcode' | translate}} </th> -->
                                                                <th scope="col" style="width:12%;">{{'itemcode' | translate}}</th>
                                                                <th scope="col" style="width:12%;">{{'uom' | translate}}</th>
                                                                <th scope="col" style="width:8%;text-align: right; padding-right: 30px;">{{'stock' | translate}}</th>
                                                                <th scope="col" style="width:4%;text-align: center;">{{'action' | translate}}</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="font-sm">
                                
                                                            <tr *ngFor="let contact of contacts ; let i = index">
                                
                                                                <td style="width:4%;">
                                                                    <mat-checkbox name="togglereqd"   [(ngModel)]="contact.checked" [disabled]="contact.isDisabled"
                                                                    [ngModelOptions]="{standalone: true}" (change)="onChange($event, contact)"></mat-checkbox>
                                                                </td>
                                                                <td style="width:12%;"> {{contact.BRANCHNAME}} </td>
                                
                                                                <td style="width:38%;"> {{contact.ITEMNAME}} </td>
                                
                                                               
                                                                <td style="width:12%;">
                                                                    {{contact.ITEMCODE}}</td>
                                                                <td style="width:12%;">
                                                                    {{contact.UOM}}</td>
                                                                <td style="width:8%; text-align: right; padding-right: 30px;">
                                                                    {{contact.STOCK | number : '1.3-3'}}</td>
                                                                <td style="width:4%;">
                                                                    <button [disabled]="isLoadingResults" type="button" [disabled]="contact.isDisabled"
                                                                    class="btn btn-sm btn-info rounded" (click)="deactivateValidate(contact,contact)" matTooltip="{{deactivateMsg}}"
                                                                    matTooltipClass="custom-tooltip-class">{{'deactivate'|translate}}</button></td> 
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-sm btn-info rounded" (click)="validateBeforeSave(newData,'Insert')"
                     [disabled]="isLoadingResults || newData.unit==null || newData.unit==undefined || newData.unit== '' || newData.PARENTITEMID==null || newData.PARENTITEMID==undefined || newData.PARENTITEMID== ''">{{'mapconfirm'|translate}}</button>
                   
                    <button [disabled]="isLoadingResults"  type="button" style="width: 75px;"class="btn btn-sm btn-secondary rounded bg-danger"
                    [routerLink]="['/management-planner']">{{'cancel'|translate}}</button>
                </div>
            </form>
            <!-- <app-footer></app-footer> -->
        </div>
    </div>
</div>