import * as tslib_1 from "tslib";
import { Input, Output, ViewChild, Component, ElementRef, EventEmitter, forwardRef, HostListener, IterableDiffers, ChangeDetectorRef, ContentChild, TemplateRef, Optional, Inject, InjectionToken, ChangeDetectionStrategy } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { DomSanitizer } from '@angular/platform-browser';
import { Subject, BehaviorSubject, EMPTY, of, from, merge, combineLatest } from 'rxjs';
import { tap, filter, map, share, flatMap, toArray, distinctUntilChanged } from 'rxjs/operators';
import * as lodashNs from 'lodash';
import * as escapeStringNs from 'escape-string-regexp';
import { NgxSelectOptGroup, NgxSelectOption } from './ngx-select.classes';
import { NgxSelectOptionDirective, NgxSelectOptionNotFoundDirective, NgxSelectOptionSelectedDirective } from './ngx-templates.directive';
var _ = lodashNs;
var escapeString = escapeStringNs;
export var NGX_SELECT_OPTIONS = new InjectionToken('NGX_SELECT_OPTIONS');
var ENavigation;
(function (ENavigation) {
    ENavigation[ENavigation["first"] = 0] = "first";
    ENavigation[ENavigation["previous"] = 1] = "previous";
    ENavigation[ENavigation["next"] = 2] = "next";
    ENavigation[ENavigation["last"] = 3] = "last";
    ENavigation[ENavigation["firstSelected"] = 4] = "firstSelected";
    ENavigation[ENavigation["firstIfOptionActiveInvisible"] = 5] = "firstIfOptionActiveInvisible";
})(ENavigation || (ENavigation = {}));
function propertyExists(obj, propertyName) {
    return propertyName in obj;
}
var NgxSelectComponent = /** @class */ (function () {
    function NgxSelectComponent(iterableDiffers, sanitizer, cd, defaultOptions) {
        var _this = this;
        this.sanitizer = sanitizer;
        this.cd = cd;
        this.optionValueField = 'id';
        this.optionTextField = 'text';
        this.optGroupLabelField = 'label';
        this.optGroupOptionsField = 'options';
        this.multiple = false;
        this.allowClear = false;
        this.placeholder = '';
        this.noAutoComplete = false;
        this.disabled = false;
        this.defaultValue = [];
        this.autoSelectSingleOption = false;
        this.autoClearSearch = false;
        this.noResultsFound = 'No results found';
        this.size = 'default';
        this.autoActiveOnMouseEnter = true;
        this.showOptionNotFoundForEmptyItems = false;
        this.isFocused = false;
        this.keepSelectMenuOpened = false;
        this.autocomplete = 'off';
        this.dropDownMenuOtherClasses = '';
        this.keyCodeToRemoveSelected = 'Delete';
        this.keyCodeToOptionsOpen = ['Enter', 'NumpadEnter'];
        this.keyCodeToOptionsClose = 'Escape';
        this.keyCodeToOptionsSelect = ['Enter', 'NumpadEnter'];
        this.keyCodeToNavigateFirst = 'ArrowLeft';
        this.keyCodeToNavigatePrevious = 'ArrowUp';
        this.keyCodeToNavigateNext = 'ArrowDown';
        this.keyCodeToNavigateLast = 'ArrowRight';
        this.typed = new EventEmitter();
        this.focus = new EventEmitter();
        this.blur = new EventEmitter();
        this.open = new EventEmitter();
        this.close = new EventEmitter();
        this.select = new EventEmitter();
        this.remove = new EventEmitter();
        this.navigated = new EventEmitter();
        this.selectionChanges = new EventEmitter();
        this.optionsOpened = false;
        this.actualValue = [];
        this.subjOptions = new BehaviorSubject([]);
        this.subjSearchText = new BehaviorSubject('');
        this.subjOptionsSelected = new BehaviorSubject([]);
        this.subjExternalValue = new BehaviorSubject([]);
        this.subjDefaultValue = new BehaviorSubject([]);
        this.subjRegisterOnChange = new Subject();
        this._focusToInput = false;
        //////////// interface ControlValueAccessor ////////////
        this.onChange = function (v) { return v; };
        this.onTouched = function () { return null; };
        Object.assign(this, defaultOptions);
        // DIFFERS
        this.itemsDiffer = iterableDiffers.find([]).create(null);
        this.defaultValueDiffer = iterableDiffers.find([]).create(null);
        // OBSERVERS
        this.typed.subscribe(function (text) { return _this.subjSearchText.next(text); });
        this.subjOptionsSelected.subscribe(function (options) { return _this.selectionChanges.emit(options); });
        var cacheExternalValue;
        // Get actual value
        var subjActualValue = combineLatest(merge(this.subjExternalValue.pipe(map(function (v) { return cacheExternalValue = v === null ? [] : [].concat(v); })), this.subjOptionsSelected.pipe(map(function (options) { return options.map(function (o) { return o.value; }); }))), this.subjDefaultValue).pipe(map(function (_a) {
            var _b = tslib_1.__read(_a, 2), eVal = _b[0], dVal = _b[1];
            var newVal = _.isEqual(eVal, dVal) ? [] : eVal;
            return newVal.length ? newVal : dVal;
        }), distinctUntilChanged(function (x, y) { return _.isEqual(x, y); }), share());
        // Export actual value
        combineLatest(subjActualValue, this.subjRegisterOnChange)
            .pipe(map(function (_a) {
            var _b = tslib_1.__read(_a, 1), actualValue = _b[0];
            return actualValue;
        }))
            .subscribe(function (actualValue) {
            _this.actualValue = actualValue;
            if (!_.isEqual(actualValue, cacheExternalValue)) {
                cacheExternalValue = actualValue;
                if (_this.multiple) {
                    _this.onChange(actualValue);
                }
                else {
                    _this.onChange(actualValue.length ? actualValue[0] : null);
                }
            }
        });
        // Correct selected options when the options changed
        combineLatest(this.subjOptions.pipe(flatMap(function (options) { return from(options).pipe(flatMap(function (option) { return option instanceof NgxSelectOption
            ? of(option)
            : (option instanceof NgxSelectOptGroup ? from(option.options) : EMPTY); }), toArray()); })), subjActualValue).pipe(map(function (_a) {
            var _b = tslib_1.__read(_a, 2), optionsFlat = _b[0], actualValue = _b[1];
            var optionsSelected = [];
            actualValue.forEach(function (value) {
                var selectedOption = optionsFlat.find(function (option) { return option.value === value; });
                if (selectedOption) {
                    optionsSelected.push(selectedOption);
                }
            });
            if (_this.keepSelectedItems) {
                var optionValues_1 = optionsSelected.map(function (option) { return option.value; });
                var keptSelectedOptions = _this.subjOptionsSelected.value
                    .filter(function (selOption) { return optionValues_1.indexOf(selOption.value) === -1; });
                optionsSelected.push.apply(optionsSelected, tslib_1.__spread(keptSelectedOptions));
            }
            if (!_.isEqual(optionsSelected, _this.subjOptionsSelected.value)) {
                _this.subjOptionsSelected.next(optionsSelected);
                _this.cd.markForCheck();
            }
        })).subscribe();
        // Ensure working filter by a search text
        combineLatest(this.subjOptions, this.subjOptionsSelected, this.subjSearchText).pipe(map(function (_a) {
            var _b = tslib_1.__read(_a, 3), options = _b[0], selectedOptions = _b[1], search = _b[2];
            _this.optionsFiltered = _this.filterOptions(search, options, selectedOptions).map(function (option) {
                if (option instanceof NgxSelectOption) {
                    option.highlightedText = _this.highlightOption(option);
                }
                else if (option instanceof NgxSelectOptGroup) {
                    option.options.map(function (subOption) {
                        subOption.highlightedText = _this.highlightOption(subOption);
                        return subOption;
                    });
                }
                return option;
            });
            _this.cacheOptionsFilteredFlat = null;
            _this.navigateOption(ENavigation.firstIfOptionActiveInvisible);
            _this.cd.markForCheck();
            return selectedOptions;
        }), flatMap(function (selectedOptions) { return _this.optionsFilteredFlat().pipe(filter(function (flatOptions) { return _this.autoSelectSingleOption && flatOptions.length === 1 && !selectedOptions.length; })); })).subscribe(function (flatOptions) {
            _this.subjOptionsSelected.next(flatOptions);
            _this.cd.markForCheck();
        });
    }
    NgxSelectComponent_1 = NgxSelectComponent;
    Object.defineProperty(NgxSelectComponent.prototype, "inputText", {
        /** @internal */
        get: function () {
            if (this.inputElRef && this.inputElRef.nativeElement) {
                return this.inputElRef.nativeElement.value;
            }
            return '';
        },
        enumerable: true,
        configurable: true
    });
    NgxSelectComponent.prototype.setFormControlSize = function (otherClassNames, useFormControl) {
        if (otherClassNames === void 0) { otherClassNames = {}; }
        if (useFormControl === void 0) { useFormControl = true; }
        var formControlExtraClasses = useFormControl ? {
            'form-control-sm input-sm': this.size === 'small',
            'form-control-lg input-lg': this.size === 'large'
        } : {};
        return Object.assign(formControlExtraClasses, otherClassNames);
    };
    NgxSelectComponent.prototype.setBtnSize = function () {
        return { 'btn-sm': this.size === 'small', 'btn-lg': this.size === 'large' };
    };
    Object.defineProperty(NgxSelectComponent.prototype, "optionsSelected", {
        get: function () {
            return this.subjOptionsSelected.value;
        },
        enumerable: true,
        configurable: true
    });
    NgxSelectComponent.prototype.mainClicked = function (event) {
        event.clickedSelectComponent = this;
        if (!this.isFocused) {
            this.isFocused = true;
            this.focus.emit();
        }
    };
    NgxSelectComponent.prototype.documentClick = function (event) {
        if (event.clickedSelectComponent !== this) {
            if (this.optionsOpened) {
                this.optionsClose();
                this.cd.detectChanges(); // fix error because of delay between different events
            }
            if (this.isFocused) {
                this.isFocused = false;
                this.blur.emit();
            }
        }
    };
    NgxSelectComponent.prototype.optionsFilteredFlat = function () {
        var _this = this;
        if (this.cacheOptionsFilteredFlat) {
            return of(this.cacheOptionsFilteredFlat);
        }
        return from(this.optionsFiltered).pipe(flatMap(function (option) {
            return option instanceof NgxSelectOption ? of(option) :
                (option instanceof NgxSelectOptGroup ? from(option.optionsFiltered) : EMPTY);
        }), filter(function (optionsFilteredFlat) { return !optionsFilteredFlat.disabled; }), toArray(), tap(function (optionsFilteredFlat) { return _this.cacheOptionsFilteredFlat = optionsFilteredFlat; }));
    };
    NgxSelectComponent.prototype.navigateOption = function (navigation) {
        var _this = this;
        this.optionsFilteredFlat().pipe(map(function (options) {
            var navigated = { index: -1, activeOption: null, filteredOptionList: options };
            var newActiveIdx;
            switch (navigation) {
                case ENavigation.first:
                    navigated.index = 0;
                    break;
                case ENavigation.previous:
                    newActiveIdx = options.indexOf(_this.optionActive) - 1;
                    navigated.index = newActiveIdx >= 0 ? newActiveIdx : options.length - 1;
                    break;
                case ENavigation.next:
                    newActiveIdx = options.indexOf(_this.optionActive) + 1;
                    navigated.index = newActiveIdx < options.length ? newActiveIdx : 0;
                    break;
                case ENavigation.last:
                    navigated.index = options.length - 1;
                    break;
                case ENavigation.firstSelected:
                    if (_this.subjOptionsSelected.value.length) {
                        navigated.index = options.indexOf(_this.subjOptionsSelected.value[0]);
                    }
                    break;
                case ENavigation.firstIfOptionActiveInvisible:
                    var idxOfOptionActive = -1;
                    if (_this.optionActive) {
                        idxOfOptionActive = options.indexOf(options.find(function (x) { return x.value === _this.optionActive.value; }));
                    }
                    navigated.index = idxOfOptionActive > 0 ? idxOfOptionActive : 0;
                    break;
            }
            navigated.activeOption = options[navigated.index];
            return navigated;
        })).subscribe(function (newNavigated) { return _this.optionActivate(newNavigated); });
    };
    NgxSelectComponent.prototype.ngDoCheck = function () {
        if (this.itemsDiffer.diff(this.items)) {
            this.subjOptions.next(this.buildOptions(this.items));
        }
        var defVal = this.defaultValue ? [].concat(this.defaultValue) : [];
        if (this.defaultValueDiffer.diff(defVal)) {
            this.subjDefaultValue.next(defVal);
        }
    };
    NgxSelectComponent.prototype.ngAfterContentChecked = function () {
        if (this._focusToInput && this.checkInputVisibility() && this.inputElRef &&
            this.inputElRef.nativeElement !== document.activeElement) {
            this._focusToInput = false;
            this.inputElRef.nativeElement.focus();
        }
        if (this.choiceMenuElRef) {
            var ulElement = this.choiceMenuElRef.nativeElement;
            var element = ulElement.querySelector('a.ngx-select__item_active.active');
            if (element && element.offsetHeight > 0) {
                this.ensureVisibleElement(element);
            }
        }
    };
    NgxSelectComponent.prototype.ngOnDestroy = function () {
        this.cd.detach();
    };
    NgxSelectComponent.prototype.canClearNotMultiple = function () {
        return this.allowClear && !!this.subjOptionsSelected.value.length &&
            (!this.subjDefaultValue.value.length || this.subjDefaultValue.value[0] !== this.actualValue[0]);
    };
    NgxSelectComponent.prototype.focusToInput = function () {
        this._focusToInput = true;
    };
    NgxSelectComponent.prototype.inputKeyDown = function (event) {
        var keysForOpenedState = [].concat(this.keyCodeToOptionsSelect, this.keyCodeToNavigateFirst, this.keyCodeToNavigatePrevious, this.keyCodeToNavigateNext, this.keyCodeToNavigateLast);
        var keysForClosedState = [].concat(this.keyCodeToOptionsOpen, this.keyCodeToRemoveSelected);
        if (this.optionsOpened && keysForOpenedState.indexOf(event.code) !== -1) {
            event.preventDefault();
            event.stopPropagation();
            switch (event.code) {
                case ([].concat(this.keyCodeToOptionsSelect).indexOf(event.code) + 1) && event.code:
                    this.optionSelect(this.optionActive);
                    this.navigateOption(ENavigation.next);
                    break;
                case this.keyCodeToNavigateFirst:
                    this.navigateOption(ENavigation.first);
                    break;
                case this.keyCodeToNavigatePrevious:
                    this.navigateOption(ENavigation.previous);
                    break;
                case this.keyCodeToNavigateLast:
                    this.navigateOption(ENavigation.last);
                    break;
                case this.keyCodeToNavigateNext:
                    this.navigateOption(ENavigation.next);
                    break;
            }
        }
        else if (!this.optionsOpened && keysForClosedState.indexOf(event.code) !== -1) {
            event.preventDefault();
            event.stopPropagation();
            switch (event.code) {
                case ([].concat(this.keyCodeToOptionsOpen).indexOf(event.code) + 1) && event.code:
                    this.optionsOpen();
                    break;
                case this.keyCodeToRemoveSelected:
                    this.optionRemove(this.subjOptionsSelected.value[this.subjOptionsSelected.value.length - 1], event);
                    break;
            }
        }
    };
    NgxSelectComponent.prototype.trackByOption = function (index, option) {
        return option instanceof NgxSelectOption ? option.value :
            (option instanceof NgxSelectOptGroup ? option.label : option);
    };
    NgxSelectComponent.prototype.checkInputVisibility = function () {
        return (this.multiple === true) || (this.optionsOpened && !this.noAutoComplete);
    };
    /** @internal */
    NgxSelectComponent.prototype.inputKeyUp = function (value, event) {
        if (value === void 0) { value = ''; }
        if (event.code === this.keyCodeToOptionsClose) {
            this.optionsClose( /*true*/);
        }
        else if (this.optionsOpened && (['ArrowDown', 'ArrowUp', 'ArrowLeft', 'ArrowDown'].indexOf(event.code) === -1) /*ignore arrows*/) {
            this.typed.emit(value);
        }
        else if (!this.optionsOpened && value) {
            this.optionsOpen(value);
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.inputClick = function (value) {
        if (value === void 0) { value = ''; }
        if (!this.optionsOpened) {
            this.optionsOpen(value);
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.sanitize = function (html) {
        return html ? this.sanitizer.bypassSecurityTrustHtml(html) : null;
    };
    /** @internal */
    NgxSelectComponent.prototype.highlightOption = function (option) {
        if (this.inputElRef) {
            return option.renderText(this.sanitizer, this.inputElRef.nativeElement.value);
        }
        return option.renderText(this.sanitizer, '');
    };
    /** @internal */
    NgxSelectComponent.prototype.optionSelect = function (option, event) {
        if (event === void 0) { event = null; }
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        if (option && !option.disabled) {
            this.subjOptionsSelected.next((this.multiple ? this.subjOptionsSelected.value : []).concat([option]));
            this.select.emit(option.value);
            if (!this.keepSelectMenuOpened) {
                this.optionsClose( /*true*/);
            }
            this.onTouched();
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.optionRemove = function (option, event) {
        if (!this.disabled && option) {
            event.stopPropagation();
            this.subjOptionsSelected.next((this.multiple ? this.subjOptionsSelected.value : []).filter(function (o) { return o !== option; }));
            this.remove.emit(option.value);
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.optionActivate = function (navigated) {
        if ((this.optionActive !== navigated.activeOption) &&
            (!navigated.activeOption || !navigated.activeOption.disabled)) {
            if (this.optionActive) {
                this.optionActive.active = false;
            }
            this.optionActive = navigated.activeOption;
            if (this.optionActive) {
                this.optionActive.active = true;
            }
            this.navigated.emit(navigated);
            this.cd.detectChanges();
        }
    };
    /** @internal */
    NgxSelectComponent.prototype.onMouseEnter = function (navigated) {
        if (this.autoActiveOnMouseEnter) {
            this.optionActivate(navigated);
        }
    };
    NgxSelectComponent.prototype.filterOptions = function (search, options, selectedOptions) {
        var _this = this;
        var regExp = new RegExp(escapeString(search), 'i'), filterOption = function (option) {
            if (_this.searchCallback) {
                return _this.searchCallback(search, option);
            }
            return (!search || regExp.test(option.text)) && (!_this.multiple || selectedOptions.indexOf(option) === -1);
        };
        return options.filter(function (option) {
            if (option instanceof NgxSelectOption) {
                return filterOption(option);
            }
            else if (option instanceof NgxSelectOptGroup) {
                var subOp = option;
                subOp.filter(function (subOption) { return filterOption(subOption); });
                return subOp.optionsFiltered.length;
            }
        });
    };
    NgxSelectComponent.prototype.ensureVisibleElement = function (element) {
        if (this.choiceMenuElRef && this.cacheElementOffsetTop !== element.offsetTop) {
            this.cacheElementOffsetTop = element.offsetTop;
            var container = this.choiceMenuElRef.nativeElement;
            if (this.cacheElementOffsetTop < container.scrollTop) {
                container.scrollTop = this.cacheElementOffsetTop;
            }
            else if (this.cacheElementOffsetTop + element.offsetHeight > container.scrollTop + container.clientHeight) {
                container.scrollTop = this.cacheElementOffsetTop + element.offsetHeight - container.clientHeight;
            }
        }
    };
    NgxSelectComponent.prototype.showChoiceMenu = function () {
        return this.optionsOpened && (!!this.subjOptions.value.length || this.showOptionNotFoundForEmptyItems);
    };
    NgxSelectComponent.prototype.optionsOpen = function (search) {
        if (search === void 0) { search = ''; }
        if (!this.disabled) {
            this.optionsOpened = true;
            this.subjSearchText.next(search);
            if (!this.multiple && this.subjOptionsSelected.value.length) {
                this.navigateOption(ENavigation.firstSelected);
            }
            else {
                this.navigateOption(ENavigation.first);
            }
            this.focusToInput();
            this.open.emit();
            this.cd.markForCheck();
        }
    };
    NgxSelectComponent.prototype.optionsClose = function ( /*focusToHost: boolean = false*/) {
        this.optionsOpened = false;
        // if (focusToHost) {
        //     const x = window.scrollX, y = window.scrollY;
        //     this.mainElRef.nativeElement.focus();
        //     window.scrollTo(x, y);
        // }
        this.close.emit();
        if (this.autoClearSearch && this.multiple && this.inputElRef) {
            this.inputElRef.nativeElement.value = null;
        }
    };
    NgxSelectComponent.prototype.buildOptions = function (data) {
        var _this = this;
        var result = [];
        if (Array.isArray(data)) {
            data.forEach(function (item) {
                var isOptGroup = typeof item === 'object' && item !== null &&
                    propertyExists(item, _this.optGroupLabelField) && propertyExists(item, _this.optGroupOptionsField) &&
                    Array.isArray(item[_this.optGroupOptionsField]);
                if (isOptGroup) {
                    var optGroup_1 = new NgxSelectOptGroup(item[_this.optGroupLabelField]);
                    item[_this.optGroupOptionsField].forEach(function (subOption) {
                        var opt = _this.buildOption(subOption, optGroup_1);
                        if (opt) {
                            optGroup_1.options.push(opt);
                        }
                    });
                    result.push(optGroup_1);
                }
                else {
                    var option = _this.buildOption(item, null);
                    if (option) {
                        result.push(option);
                    }
                }
            });
        }
        return result;
    };
    NgxSelectComponent.prototype.buildOption = function (data, parent) {
        var value, text, disabled;
        if (typeof data === 'string' || typeof data === 'number') {
            value = text = data;
            disabled = false;
        }
        else if (typeof data === 'object' && data !== null &&
            (propertyExists(data, this.optionValueField) || propertyExists(data, this.optionTextField))) {
            value = propertyExists(data, this.optionValueField) ? data[this.optionValueField] : data[this.optionTextField];
            text = propertyExists(data, this.optionTextField) ? data[this.optionTextField] : data[this.optionValueField];
            disabled = propertyExists(data, 'disabled') ? data['disabled'] : false;
        }
        else {
            return null;
        }
        return new NgxSelectOption(value, text, disabled, data, parent);
    };
    NgxSelectComponent.prototype.writeValue = function (obj) {
        this.subjExternalValue.next(obj);
    };
    NgxSelectComponent.prototype.registerOnChange = function (fn) {
        this.onChange = fn;
        this.subjRegisterOnChange.next();
    };
    NgxSelectComponent.prototype.registerOnTouched = function (fn) {
        this.onTouched = fn;
    };
    NgxSelectComponent.prototype.setDisabledState = function (isDisabled) {
        this.disabled = isDisabled;
        this.cd.markForCheck();
    };
    var NgxSelectComponent_1;
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], NgxSelectComponent.prototype, "items", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "optionValueField", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "optionTextField", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "optGroupLabelField", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "optGroupOptionsField", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "multiple", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "allowClear", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "placeholder", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "noAutoComplete", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "disabled", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Array)
    ], NgxSelectComponent.prototype, "defaultValue", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "autoSelectSingleOption", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "autoClearSearch", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "noResultsFound", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Boolean)
    ], NgxSelectComponent.prototype, "keepSelectedItems", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", String)
    ], NgxSelectComponent.prototype, "size", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Function)
    ], NgxSelectComponent.prototype, "searchCallback", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "autoActiveOnMouseEnter", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "showOptionNotFoundForEmptyItems", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "isFocused", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "keepSelectMenuOpened", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "autocomplete", void 0);
    tslib_1.__decorate([
        Input(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "dropDownMenuOtherClasses", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "typed", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "focus", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "blur", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "open", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "close", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "select", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "remove", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "navigated", void 0);
    tslib_1.__decorate([
        Output(),
        tslib_1.__metadata("design:type", Object)
    ], NgxSelectComponent.prototype, "selectionChanges", void 0);
    tslib_1.__decorate([
        ViewChild('main', { static: true }),
        tslib_1.__metadata("design:type", ElementRef)
    ], NgxSelectComponent.prototype, "mainElRef", void 0);
    tslib_1.__decorate([
        ViewChild('input', { static: false }),
        tslib_1.__metadata("design:type", ElementRef)
    ], NgxSelectComponent.prototype, "inputElRef", void 0);
    tslib_1.__decorate([
        ViewChild('choiceMenu', { static: false }),
        tslib_1.__metadata("design:type", ElementRef)
    ], NgxSelectComponent.prototype, "choiceMenuElRef", void 0);
    tslib_1.__decorate([
        ContentChild(NgxSelectOptionDirective, { read: TemplateRef, static: true }),
        tslib_1.__metadata("design:type", NgxSelectOptionDirective)
    ], NgxSelectComponent.prototype, "templateOption", void 0);
    tslib_1.__decorate([
        ContentChild(NgxSelectOptionSelectedDirective, { read: TemplateRef, static: true }),
        tslib_1.__metadata("design:type", NgxSelectOptionSelectedDirective)
    ], NgxSelectComponent.prototype, "templateSelectedOption", void 0);
    tslib_1.__decorate([
        ContentChild(NgxSelectOptionNotFoundDirective, { read: TemplateRef, static: true }),
        tslib_1.__metadata("design:type", NgxSelectOptionNotFoundDirective)
    ], NgxSelectComponent.prototype, "templateOptionNotFound", void 0);
    tslib_1.__decorate([
        HostListener('document:focusin', ['$event']),
        HostListener('document:click', ['$event']),
        tslib_1.__metadata("design:type", Function),
        tslib_1.__metadata("design:paramtypes", [Object]),
        tslib_1.__metadata("design:returntype", void 0)
    ], NgxSelectComponent.prototype, "documentClick", null);
    NgxSelectComponent = NgxSelectComponent_1 = tslib_1.__decorate([
        Component({
            selector: 'ngx-select',
            template: "<div #main [tabindex]=\"disabled? -1: 0\" class=\"ngx-select dropdown\"\n     [ngClass]=\"setFormControlSize({\n        'ngx-select_multiple form-control': multiple === true,\n        'open show': optionsOpened && optionsFiltered.length\n     }, multiple === true)\"\n     (click)=\"mainClicked($event)\" (focusin)=\"mainClicked($event)\"\n     (focus)=\"focusToInput()\" (keydown)=\"inputKeyDown($event)\">\n    <div [ngClass]=\"{ 'ngx-select__disabled': disabled}\"></div>\n\n    <!-- single selected item -->\n    <div class=\"ngx-select__selected\"\n         *ngIf=\"(multiple === false) && (!optionsOpened || noAutoComplete)\">\n        <div class=\"ngx-select__toggle btn form-control\" [ngClass]=\"setFormControlSize(setBtnSize())\"\n             (click)=\"optionsOpen()\">\n\n            <span *ngIf=\"!optionsSelected.length\" class=\"ngx-select__placeholder text-muted\">\n                <span [innerHtml]=\"placeholder\"></span>\n            </span>\n            <span *ngIf=\"optionsSelected.length\"\n                  class=\"ngx-select__selected-single pull-left float-left\"\n                  [ngClass]=\"{'ngx-select__allow-clear': allowClear}\">\n                <ng-container [ngTemplateOutlet]=\"templateSelectedOption || defaultTemplateOption\"\n                              [ngTemplateOutletContext]=\"{$implicit: optionsSelected[0], index: 0,\n                                                          text: sanitize(optionsSelected[0].text)}\">\n                </ng-container>\n            </span>\n            <span class=\"ngx-select__toggle-buttons\">\n                <a class=\"ngx-select__clear btn btn-sm btn-link\" *ngIf=\"canClearNotMultiple()\"\n                   [ngClass]=\"setBtnSize()\"\n                   (click)=\"optionRemove(optionsSelected[0], $event)\">\n                    <i class=\"ngx-select__clear-icon\"></i>\n                </a>\n                <i class=\"dropdown-toggle\"></i>\n                <i class=\"ngx-select__toggle-caret caret\"></i>\n            </span>\n        </div>\n    </div>\n\n    <!-- multiple selected items -->\n    <div class=\"ngx-select__selected\" *ngIf=\"multiple === true\" (click)=\"inputClick(inputElRef && inputElRef['value'])\">\n        <span *ngFor=\"let option of optionsSelected; trackBy: trackByOption; let idx = index\">\n            <span tabindex=\"-1\" [ngClass]=\"setBtnSize()\" (click)=\"$event.stopPropagation()\"\n                  class=\"ngx-select__selected-plural btn btn-default btn-secondary btn-sm btn-xs\">\n\n                <ng-container [ngTemplateOutlet]=\"templateSelectedOption || defaultTemplateOption\"\n                              [ngTemplateOutletContext]=\"{$implicit: option, index: idx, text: sanitize(option.text)}\">\n                </ng-container>\n\n                <a class=\"ngx-select__clear btn btn-sm btn-link pull-right float-right\" [ngClass]=\"setBtnSize()\"\n                   (click)=\"optionRemove(option, $event)\">\n                    <i class=\"ngx-select__clear-icon\"></i>\n                </a>\n            </span>\n        </span>\n    </div>\n\n    <!-- live search an item from the list -->\n    <input #input type=\"text\" class=\"ngx-select__search form-control\" [ngClass]=\"setFormControlSize()\"\n           *ngIf=\"checkInputVisibility()\"\n           [tabindex]=\"multiple === false? -1: 0\"\n           (keyup)=\"inputKeyUp(input.value, $event)\"\n           [disabled]=\"disabled\"\n           [placeholder]=\"optionsSelected.length? '': placeholder\"\n           (click)=\"inputClick(input.value)\"\n           [autocomplete]=\"autocomplete\"\n           autocorrect=\"off\"\n           autocapitalize=\"off\"\n           spellcheck=\"false\"\n           role=\"combobox\">\n\n    <!-- options template -->\n    <ul #choiceMenu role=\"menu\" *ngIf=\"isFocused\" class=\"ngx-select__choices dropdown-menu\"\n        [ngClass]=\"dropDownMenuOtherClasses\"\n        [class.show]=\"showChoiceMenu()\">\n        <li class=\"ngx-select__item-group\" role=\"menuitem\"\n            *ngFor=\"let opt of optionsFiltered; trackBy: trackByOption; let idxGroup=index\">\n            <div class=\"divider dropdown-divider\" *ngIf=\"opt.type === 'optgroup' && (idxGroup > 0)\"></div>\n            <div class=\"dropdown-header\" *ngIf=\"opt.type === 'optgroup'\">{{opt.label}}</div>\n\n            <a href=\"#\" #choiceItem class=\"ngx-select__item dropdown-item\"\n               *ngFor=\"let option of (opt.optionsFiltered || [opt]); trackBy: trackByOption; let idxOption = index\"\n               [ngClass]=\"{\n                    'ngx-select__item_active active': option.active,\n                    'ngx-select__item_disabled disabled': option.disabled\n               }\"\n               (mouseenter)=\"onMouseEnter({\n                    activeOption: option,\n                    filteredOptionList: optionsFiltered,\n                    index: optionsFiltered.indexOf(option)\n               })\"\n               (click)=\"optionSelect(option, $event)\">\n                <ng-container [ngTemplateOutlet]=\"templateOption || defaultTemplateOption\"\n                              [ngTemplateOutletContext]=\"{$implicit: option, text: option.highlightedText,\n                              index: idxGroup, subIndex: idxOption}\"></ng-container>\n            </a>\n        </li>\n        <li class=\"ngx-select__item ngx-select__item_no-found dropdown-header\" *ngIf=\"!optionsFiltered.length\">\n            <ng-container [ngTemplateOutlet]=\"templateOptionNotFound || defaultTemplateOptionNotFound\"\n                          [ngTemplateOutletContext]=\"{$implicit: inputText}\"></ng-container>\n        </li>\n    </ul>\n\n    <!--Default templates-->\n    <ng-template #defaultTemplateOption let-text=\"text\">\n        <span [innerHtml]=\"text\"></span>\n    </ng-template>\n\n    <ng-template #defaultTemplateOptionNotFound>\n        {{noResultsFound}}\n    </ng-template>\n\n</div>\n",
            changeDetection: ChangeDetectionStrategy.OnPush,
            providers: [
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return NgxSelectComponent_1; }),
                    multi: true
                }
            ],
            styles: [".ngx-select_multiple{height:auto;padding:3px 3px 0}.ngx-select_multiple .ngx-select__search{background-color:transparent!important;border:none;outline:0;box-shadow:none;height:1.6666em;padding:0;margin-bottom:3px}.ngx-select__disabled{background-color:#eceeef;border-radius:4px;position:absolute;width:100%;height:100%;z-index:5;opacity:.6;top:0;left:0;cursor:not-allowed}.ngx-select__toggle{outline:0;position:relative;text-align:left!important;color:#333;background-color:#fff;border-color:#ccc;display:inline-flex;align-items:stretch;justify-content:space-between}.ngx-select__toggle:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.ngx-select__toggle-buttons{flex-shrink:0;display:flex;align-items:center}.ngx-select__toggle-caret{position:absolute;height:10px;top:50%;right:10px;margin-top:-2px}.ngx-select__placeholder{float:left;max-width:100%;text-overflow:ellipsis;overflow:hidden}.ngx-select__clear{margin-right:10px;padding:0;border:none}.ngx-select_multiple .ngx-select__clear{line-height:initial;margin-left:5px;margin-right:0;color:#000;opacity:.5}.ngx-select__clear-icon{display:inline-block;font-size:inherit;cursor:pointer;position:relative;width:1em;height:.75em;padding:0}.ngx-select__clear-icon:after,.ngx-select__clear-icon:before{content:\"\";position:absolute;border-top:3px solid;width:100%;top:50%;left:0;margin-top:-1px}.ngx-select__clear-icon:before{-webkit-transform:rotate(45deg);transform:rotate(45deg)}.ngx-select__clear-icon:after{-webkit-transform:rotate(-45deg);transform:rotate(-45deg)}.ngx-select__choices{width:100%;height:auto;max-height:200px;overflow-x:hidden;margin-top:0;position:absolute}.ngx-select_multiple .ngx-select__choices{margin-top:1px}.ngx-select__item{display:block;padding:3px 20px;clear:both;font-weight:400;line-height:1.42857143;white-space:nowrap;cursor:pointer;text-decoration:none}.ngx-select__item_disabled,.ngx-select__item_no-found{cursor:default}.ngx-select__item_active{color:#fff;outline:0;background-color:#428bca}.ngx-select__selected-plural,.ngx-select__selected-single{display:inline-flex;align-items:center;overflow:hidden}.ngx-select__selected-plural span,.ngx-select__selected-single span{overflow:hidden;text-overflow:ellipsis}.ngx-select__selected-plural{outline:0;margin:0 3px 3px 0}.input-group>.dropdown{position:static}"]
        }),
        tslib_1.__param(3, Inject(NGX_SELECT_OPTIONS)), tslib_1.__param(3, Optional()),
        tslib_1.__metadata("design:paramtypes", [IterableDiffers, DomSanitizer, ChangeDetectorRef, Object])
    ], NgxSelectComponent);
    return NgxSelectComponent;
}());
export { NgxSelectComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXNlbGVjdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtc2VsZWN0LWV4LyIsInNvdXJjZXMiOlsibmd4LXNlbGVjdC9uZ3gtc2VsZWN0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUdILEtBQUssRUFDTCxNQUFNLEVBQ04sU0FBUyxFQUNULFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLFVBQVUsRUFDVixZQUFZLEVBRVosZUFBZSxFQUNmLGlCQUFpQixFQUNqQixZQUFZLEVBQ1osV0FBVyxFQUNYLFFBQVEsRUFDUixNQUFNLEVBQ04sY0FBYyxFQUNkLHVCQUF1QixFQUUxQixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQXVCLGlCQUFpQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkUsT0FBTyxFQUFDLFlBQVksRUFBVyxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBYSxPQUFPLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFDakcsT0FBTyxFQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLG9CQUFvQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDL0YsT0FBTyxLQUFLLFFBQVEsTUFBTSxRQUFRLENBQUM7QUFDbkMsT0FBTyxLQUFLLGNBQWMsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RCxPQUFPLEVBQUMsaUJBQWlCLEVBQUUsZUFBZSxFQUFnQixNQUFNLHNCQUFzQixDQUFDO0FBQ3ZGLE9BQU8sRUFDSCx3QkFBd0IsRUFDeEIsZ0NBQWdDLEVBQ2hDLGdDQUFnQyxFQUNuQyxNQUFNLDJCQUEyQixDQUFDO0FBR25DLElBQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQztBQUNuQixJQUFNLFlBQVksR0FBRyxj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QVcsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFDLENBQUM7MENBQzFELGdDQUFnQztzRUFBQztJQUd6RDtRQURDLFlBQVksQ0FBQyxnQ0FBZ0MsRUFBRSxFQUFDLElBQUksRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBQyxDQUFDOzBDQUMxRCxnQ0FBZ0M7c0VBQUM7SUEyS3pEO1FBRkMsWUFBWSxDQUFDLGtCQUFrQixFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDNUMsWUFBWSxDQUFDLGdCQUFnQixFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7Ozs7MkRBWTFDO0lBM09RLGtCQUFrQjtRQWI5QixTQUFTLENBQUM7WUFDUCxRQUFRLEVBQUUsWUFBWTtZQUN0QiwyMExBQTBDO1lBRTFDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO1lBQy9DLFNBQVMsRUFBRTtnQkFDUDtvQkFDSSxPQUFPLEVBQUUsaUJBQWlCO29CQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLGNBQU0sT0FBQSxvQkFBa0IsRUFBbEIsQ0FBa0IsQ0FBQztvQkFDakQsS0FBSyxFQUFFLElBQUk7aUJBQ2Q7YUFDSjs7U0FDSixDQUFDO1FBc0ZlLG1CQUFBLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFBLEVBQUUsbUJBQUEsUUFBUSxFQUFFLENBQUE7aURBRHRCLGVBQWUsRUFBcUIsWUFBWSxFQUFjLGlCQUFpQjtPQXBGbkcsa0JBQWtCLENBdWxCOUI7SUFBRCx5QkFBQztDQUFBLEFBdmxCRCxJQXVsQkM7U0F2bEJZLGtCQUFrQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQWZ0ZXJDb250ZW50Q2hlY2tlZCxcbiAgICBEb0NoZWNrLFxuICAgIElucHV0LFxuICAgIE91dHB1dCxcbiAgICBWaWV3Q2hpbGQsXG4gICAgQ29tcG9uZW50LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIGZvcndhcmRSZWYsXG4gICAgSG9zdExpc3RlbmVyLFxuICAgIEl0ZXJhYmxlRGlmZmVyLFxuICAgIEl0ZXJhYmxlRGlmZmVycyxcbiAgICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBDb250ZW50Q2hpbGQsXG4gICAgVGVtcGxhdGVSZWYsXG4gICAgT3B0aW9uYWwsXG4gICAgSW5qZWN0LFxuICAgIEluamVjdGlvblRva2VuLFxuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIE9uRGVzdHJveVxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7Q29udHJvbFZhbHVlQWNjZXNzb3IsIE5HX1ZBTFVFX0FDQ0VTU09SfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQge0RvbVNhbml0aXplciwgU2FmZUh0bWx9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHtPYnNlcnZhYmxlLCBTdWJqZWN0LCBCZWhhdmlvclN1YmplY3QsIEVNUFRZLCBvZiwgZnJvbSwgbWVyZ2UsIGNvbWJpbmVMYXRlc3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHt0YXAsIGZpbHRlciwgbWFwLCBzaGFyZSwgZmxhdE1hcCwgdG9BcnJheSwgZGlzdGluY3RVbnRpbENoYW5nZWR9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCAqIGFzIGxvZGFzaE5zIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgKiBhcyBlc2NhcGVTdHJpbmdOcyBmcm9tICdlc2NhcGUtc3RyaW5nLXJlZ2V4cCc7XG5pbXBvcnQge05neFNlbGVjdE9wdEdyb3VwLCBOZ3hTZWxlY3RPcHRpb24sIFRTZWxlY3RPcHRpb259IGZyb20gJy4vbmd4LXNlbGVjdC5jbGFzc2VzJztcbmltcG9ydCB7XG4gICAgTmd4U2VsZWN0T3B0aW9uRGlyZWN0aXZlLFxuICAgIE5neFNlbGVjdE9wdGlvbk5vdEZvdW5kRGlyZWN0aXZlLFxuICAgIE5neFNlbGVjdE9wdGlvblNlbGVjdGVkRGlyZWN0aXZlXG59IGZyb20gJy4vbmd4LXRlbXBsYXRlcy5kaXJlY3RpdmUnO1xuaW1wb3J0IHtJTmd4T3B0aW9uTmF2aWdhdGVkLCBJTmd4U2VsZWN0T3B0aW9uLCBJTmd4U2VsZWN0T3B0aW9uc30gZnJvbSAnLi9uZ3gtc2VsZWN0LmludGVyZmFjZXMnO1xuXG5jb25zdCBfID0gbG9kYXNoTnM7XG5jb25zdCBlc2NhcGVTdHJpbmcgPSBlc2NhcGVTdHJpbmdOcztcblxuZXhwb3J0IGNvbnN0IE5HWF9TRUxFQ1RfT1BUSU9OUyA9IG5ldyBJbmplY3Rpb25Ub2tlbjxhbnk+KCdOR1hfU0VMRUNUX09QVElPTlMnKTtcblxuZXhwb3J0IGludGVyZmFjZSBJTmd4U2VsZWN0Q29tcG9uZW50TW91c2VFdmVudCBleHRlbmRzIE1vdXNlRXZlbnQge1xuICAgIGNsaWNrZWRTZWxlY3RDb21wb25lbnQ/OiBOZ3hTZWxlY3RDb21wb25lbnQ7XG59XG5cbmVudW0gRU5hdmlnYXRpb24ge1xuICAgIGZpcnN0LCBwcmV2aW91cywgbmV4dCwgbGFzdCxcbiAgICBmaXJzdFNlbGVjdGVkLCBmaXJzdElmT3B0aW9uQWN0aXZlSW52aXNpYmxlXG59XG5cbmZ1bmN0aW9uIHByb3BlcnR5RXhpc3RzKG9iajogb2JqZWN0LCBwcm9wZXJ0eU5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiBwcm9wZXJ0eU5hbWUgaW4gb2JqO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25neC1zZWxlY3QnLFxuICAgIHRlbXBsYXRlVXJsOiAnLi9uZ3gtc2VsZWN0LmNvbXBvbmVudC5odG1sJyxcbiAgICBzdHlsZVVybHM6IFsnLi9uZ3gtc2VsZWN0LmNvbXBvbmVudC5zY3NzJ10sXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gICAgcHJvdmlkZXJzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuICAgICAgICAgICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTmd4U2VsZWN0Q29tcG9uZW50KSxcbiAgICAgICAgICAgIG11bHRpOiB0cnVlXG4gICAgICAgIH1cbiAgICBdXG59KVxuZXhwb3J0IGNsYXNzIE5neFNlbGVjdENvbXBvbmVudCBpbXBsZW1lbnRzIElOZ3hTZWxlY3RPcHRpb25zLCBDb250cm9sVmFsdWVBY2Nlc3NvciwgRG9DaGVjaywgQWZ0ZXJDb250ZW50Q2hlY2tlZCwgT25EZXN0cm95IHtcbiAgICBASW5wdXQoKSBwdWJsaWMgaXRlbXM6IGFueVtdO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBvcHRpb25WYWx1ZUZpZWxkID0gJ2lkJztcbiAgICBASW5wdXQoKSBwdWJsaWMgb3B0aW9uVGV4dEZpZWxkID0gJ3RleHQnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBvcHRHcm91cExhYmVsRmllbGQgPSAnbGFiZWwnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBvcHRHcm91cE9wdGlvbnNGaWVsZCA9ICdvcHRpb25zJztcbiAgICBASW5wdXQoKSBwdWJsaWMgbXVsdGlwbGUgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgYWxsb3dDbGVhciA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBwbGFjZWhvbGRlciA9ICcnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBub0F1dG9Db21wbGV0ZSA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBkaXNhYmxlZCA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBkZWZhdWx0VmFsdWU6IGFueVtdID0gW107XG4gICAgQElucHV0KCkgcHVibGljIGF1dG9TZWxlY3RTaW5nbGVPcHRpb24gPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgYXV0b0NsZWFyU2VhcmNoID0gZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIG5vUmVzdWx0c0ZvdW5kID0gJ05vIHJlc3VsdHMgZm91bmQnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBrZWVwU2VsZWN0ZWRJdGVtczogZmFsc2U7XG4gICAgQElucHV0KCkgcHVibGljIHNpemU6ICdzbWFsbCcgfCAnZGVmYXVsdCcgfCAnbGFyZ2UnID0gJ2RlZmF1bHQnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBzZWFyY2hDYWxsYmFjazogKHNlYXJjaDogc3RyaW5nLCBpdGVtOiBJTmd4U2VsZWN0T3B0aW9uKSA9PiBib29sZWFuO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBhdXRvQWN0aXZlT25Nb3VzZUVudGVyID0gdHJ1ZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgc2hvd09wdGlvbk5vdEZvdW5kRm9yRW1wdHlJdGVtcyA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBpc0ZvY3VzZWQgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMga2VlcFNlbGVjdE1lbnVPcGVuZWQgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBwdWJsaWMgYXV0b2NvbXBsZXRlID0gJ29mZic7XG4gICAgQElucHV0KCkgcHVibGljIGRyb3BEb3duTWVudU90aGVyQ2xhc3NlcyA9ICcnO1xuICAgIHB1YmxpYyBrZXlDb2RlVG9SZW1vdmVTZWxlY3RlZCA9ICdEZWxldGUnO1xuICAgIHB1YmxpYyBrZXlDb2RlVG9PcHRpb25zT3BlbiA9IFsnRW50ZXInLCAnTnVtcGFkRW50ZXInXTtcbiAgICBwdWJsaWMga2V5Q29kZVRvT3B0aW9uc0Nsb3NlID0gJ0VzY2FwZSc7XG4gICAgcHVibGljIGtleUNvZGVUb09wdGlvbnNTZWxlY3QgPSBbJ0VudGVyJywgJ051bXBhZEVudGVyJ107XG4gICAgcHVibGljIGtleUNvZGVUb05hdmlnYXRlRmlyc3QgPSAnQXJyb3dMZWZ0JztcbiAgICBwdWJsaWMga2V5Q29kZVRvTmF2aWdhdGVQcmV2aW91cyA9ICdBcnJvd1VwJztcbiAgICBwdWJsaWMga2V5Q29kZVRvTmF2aWdhdGVOZXh0ID0gJ0Fycm93RG93bic7XG4gICAgcHVibGljIGtleUNvZGVUb05hdmlnYXRlTGFzdCA9ICdBcnJvd1JpZ2h0JztcblxuICAgIEBPdXRwdXQoKSBwdWJsaWMgdHlwZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcbiAgICBAT3V0cHV0KCkgcHVibGljIGZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICAgIEBPdXRwdXQoKSBwdWJsaWMgYmx1ciA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgICBAT3V0cHV0KCkgcHVibGljIG9wZW4gPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBjbG9zZSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcbiAgICBAT3V0cHV0KCkgcHVibGljIHNlbGVjdCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAgIEBPdXRwdXQoKSBwdWJsaWMgcmVtb3ZlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBuYXZpZ2F0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPElOZ3hPcHRpb25OYXZpZ2F0ZWQ+KCk7XG4gICAgQE91dHB1dCgpIHB1YmxpYyBzZWxlY3Rpb25DaGFuZ2VzID0gbmV3IEV2ZW50RW1pdHRlcjxJTmd4U2VsZWN0T3B0aW9uW10+KCk7XG5cbiAgICBAVmlld0NoaWxkKCdtYWluJywge3N0YXRpYzogdHJ1ZX0pIHByb3RlY3RlZCBtYWluRWxSZWY6IEVsZW1lbnRSZWY7XG4gICAgQFZpZXdDaGlsZCgnaW5wdXQnLCB7c3RhdGljOiBmYWxzZX0pIHB1YmxpYyBpbnB1dEVsUmVmOiBFbGVtZW50UmVmO1xuICAgIEBWaWV3Q2hpbGQoJ2Nob2ljZU1lbnUnLCB7c3RhdGljOiBmYWxzZX0pIHByb3RlY3RlZCBjaG9pY2VNZW51RWxSZWY6IEVsZW1lbnRSZWY7XG5cbiAgICBAQ29udGVudENoaWxkKE5neFNlbGVjdE9wdGlvbkRpcmVjdGl2ZSwge3JlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWV9KSB0ZW1wbGF0ZU9wdGlvbjogTmd4U2VsZWN0T3B0aW9uRGlyZWN0aXZlO1xuXG4gICAgQENvbnRlbnRDaGlsZChOZ3hTZWxlY3RPcHRpb25TZWxlY3RlZERpcmVjdGl2ZSwge3JlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWV9KVxuICAgIHRlbXBsYXRlU2VsZWN0ZWRPcHRpb246IE5neFNlbGVjdE9wdGlvblNlbGVjdGVkRGlyZWN0aXZlO1xuXG4gICAgQENvbnRlbnRDaGlsZChOZ3hTZWxlY3RPcHRpb25Ob3RGb3VuZERpcmVjdGl2ZSwge3JlYWQ6IFRlbXBsYXRlUmVmLCBzdGF0aWM6IHRydWV9KVxuICAgIHRlbXBsYXRlT3B0aW9uTm90Rm91bmQ6IE5neFNlbGVjdE9wdGlvbk5vdEZvdW5kRGlyZWN0aXZlO1xuXG4gICAgcHVibGljIG9wdGlvbnNPcGVuZWQgPSBmYWxzZTtcbiAgICBwdWJsaWMgb3B0aW9uc0ZpbHRlcmVkOiBUU2VsZWN0T3B0aW9uW107XG5cbiAgICBwcml2YXRlIG9wdGlvbkFjdGl2ZTogTmd4U2VsZWN0T3B0aW9uO1xuICAgIHByaXZhdGUgaXRlbXNEaWZmZXI6IEl0ZXJhYmxlRGlmZmVyPGFueT47XG4gICAgcHJpdmF0ZSBkZWZhdWx0VmFsdWVEaWZmZXI6IEl0ZXJhYmxlRGlmZmVyPGFueVtdPjtcbiAgICBwcml2YXRlIGFjdHVhbFZhbHVlOiBhbnlbXSA9IFtdO1xuXG4gICAgcHVibGljIHN1YmpPcHRpb25zID0gbmV3IEJlaGF2aW9yU3ViamVjdDxUU2VsZWN0T3B0aW9uW10+KFtdKTtcbiAgICBwcml2YXRlIHN1YmpTZWFyY2hUZXh0ID0gbmV3IEJlaGF2aW9yU3ViamVjdDxzdHJpbmc+KCcnKTtcblxuICAgIHByaXZhdGUgc3Viak9wdGlvbnNTZWxlY3RlZCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8Tmd4U2VsZWN0T3B0aW9uW10+KFtdKTtcbiAgICBwcml2YXRlIHN1YmpFeHRlcm5hbFZhbHVlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnlbXT4oW10pO1xuICAgIHByaXZhdGUgc3ViakRlZmF1bHRWYWx1ZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8YW55W10+KFtdKTtcbiAgICBwcml2YXRlIHN1YmpSZWdpc3Rlck9uQ2hhbmdlID0gbmV3IFN1YmplY3QoKTtcblxuICAgIHByaXZhdGUgY2FjaGVPcHRpb25zRmlsdGVyZWRGbGF0OiBOZ3hTZWxlY3RPcHRpb25bXTtcbiAgICBwcml2YXRlIGNhY2hlRWxlbWVudE9mZnNldFRvcDogbnVtYmVyO1xuXG4gICAgcHJpdmF0ZSBfZm9jdXNUb0lucHV0ID0gZmFsc2U7XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIGdldCBpbnB1dFRleHQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlucHV0RWxSZWYgJiYgdGhpcy5pbnB1dEVsUmVmLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmlucHV0RWxSZWYubmF0aXZlRWxlbWVudC52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuXG4gICAgY29uc3RydWN0b3IoaXRlcmFibGVEaWZmZXJzOiBJdGVyYWJsZURpZmZlcnMsIHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgICAgICAgICAgICAgIEBJbmplY3QoTkdYX1NFTEVDVF9PUFRJT05TKSBAT3B0aW9uYWwoKSBkZWZhdWx0T3B0aW9uczogSU5neFNlbGVjdE9wdGlvbnMpIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBkZWZhdWx0T3B0aW9ucyk7XG5cbiAgICAgICAgLy8gRElGRkVSU1xuICAgICAgICB0aGlzLml0ZW1zRGlmZmVyID0gaXRlcmFibGVEaWZmZXJzLmZpbmQoW10pLmNyZWF0ZTxhbnk+KG51bGwpO1xuICAgICAgICB0aGlzLmRlZmF1bHRWYWx1ZURpZmZlciA9IGl0ZXJhYmxlRGlmZmVycy5maW5kKFtdKS5jcmVhdGU8YW55PihudWxsKTtcblxuICAgICAgICAvLyBPQlNFUlZFUlNcbiAgICAgICAgdGhpcy50eXBlZC5zdWJzY3JpYmUoKHRleHQ6IHN0cmluZykgPT4gdGhpcy5zdWJqU2VhcmNoVGV4dC5uZXh0KHRleHQpKTtcbiAgICAgICAgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnN1YnNjcmliZSgob3B0aW9uczogTmd4U2VsZWN0T3B0aW9uW10pID0+IHRoaXMuc2VsZWN0aW9uQ2hhbmdlcy5lbWl0KG9wdGlvbnMpKTtcbiAgICAgICAgbGV0IGNhY2hlRXh0ZXJuYWxWYWx1ZTogYW55W107XG5cbiAgICAgICAgLy8gR2V0IGFjdHVhbCB2YWx1ZVxuICAgICAgICBjb25zdCBzdWJqQWN0dWFsVmFsdWUgPSBjb21iaW5lTGF0ZXN0KFxuICAgICAgICAgICAgbWVyZ2UoXG4gICAgICAgICAgICAgICAgdGhpcy5zdWJqRXh0ZXJuYWxWYWx1ZS5waXBlKG1hcChcbiAgICAgICAgICAgICAgICAgICAgKHY6IGFueVtdKSA9PiBjYWNoZUV4dGVybmFsVmFsdWUgPSB2ID09PSBudWxsID8gW10gOiBbXS5jb25jYXQodilcbiAgICAgICAgICAgICAgICApKSxcbiAgICAgICAgICAgICAgICB0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQucGlwZShtYXAoXG4gICAgICAgICAgICAgICAgICAgIChvcHRpb25zOiBOZ3hTZWxlY3RPcHRpb25bXSkgPT4gb3B0aW9ucy5tYXAoKG86IE5neFNlbGVjdE9wdGlvbikgPT4gby52YWx1ZSlcbiAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHRoaXMuc3ViakRlZmF1bHRWYWx1ZVxuICAgICAgICApLnBpcGUoXG4gICAgICAgICAgICBtYXAoKFtlVmFsLCBkVmFsXTogW2FueVtdLCBhbnlbXV0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWwgPSBfLmlzRXF1YWwoZVZhbCwgZFZhbCkgPyBbXSA6IGVWYWw7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ld1ZhbC5sZW5ndGggPyBuZXdWYWwgOiBkVmFsO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgoeCwgeSkgPT4gXy5pc0VxdWFsKHgsIHkpKSxcbiAgICAgICAgICAgIHNoYXJlKClcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBFeHBvcnQgYWN0dWFsIHZhbHVlXG4gICAgICAgIGNvbWJpbmVMYXRlc3Qoc3ViakFjdHVhbFZhbHVlLCB0aGlzLnN1YmpSZWdpc3Rlck9uQ2hhbmdlKVxuICAgICAgICAgICAgLnBpcGUobWFwKChbYWN0dWFsVmFsdWVdOiBbYW55W10sIGFueVtdXSkgPT4gYWN0dWFsVmFsdWUpKVxuICAgICAgICAgICAgLnN1YnNjcmliZSgoYWN0dWFsVmFsdWU6IGFueVtdKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hY3R1YWxWYWx1ZSA9IGFjdHVhbFZhbHVlO1xuICAgICAgICAgICAgICAgIGlmICghXy5pc0VxdWFsKGFjdHVhbFZhbHVlLCBjYWNoZUV4dGVybmFsVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlRXh0ZXJuYWxWYWx1ZSA9IGFjdHVhbFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZShhY3R1YWxWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKGFjdHVhbFZhbHVlLmxlbmd0aCA/IGFjdHVhbFZhbHVlWzBdIDogbnVsbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBDb3JyZWN0IHNlbGVjdGVkIG9wdGlvbnMgd2hlbiB0aGUgb3B0aW9ucyBjaGFuZ2VkXG4gICAgICAgIGNvbWJpbmVMYXRlc3QoXG4gICAgICAgICAgICB0aGlzLnN1YmpPcHRpb25zLnBpcGUoXG4gICAgICAgICAgICAgICAgZmxhdE1hcCgob3B0aW9uczogVFNlbGVjdE9wdGlvbltdKSA9PiBmcm9tKG9wdGlvbnMpLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgIGZsYXRNYXAoKG9wdGlvbjogVFNlbGVjdE9wdGlvbikgPT4gb3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICA/IG9mKG9wdGlvbilcbiAgICAgICAgICAgICAgICAgICAgICAgIDogKG9wdGlvbiBpbnN0YW5jZW9mIE5neFNlbGVjdE9wdEdyb3VwID8gZnJvbShvcHRpb24ub3B0aW9ucykgOiBFTVBUWSlcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICAgdG9BcnJheSgpXG4gICAgICAgICAgICAgICAgKSlcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBzdWJqQWN0dWFsVmFsdWVcbiAgICAgICAgKS5waXBlKFxuICAgICAgICAgICAgbWFwKChbb3B0aW9uc0ZsYXQsIGFjdHVhbFZhbHVlXTogW05neFNlbGVjdE9wdGlvbltdLCBhbnlbXV0pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25zU2VsZWN0ZWQgPSBbXTtcblxuICAgICAgICAgICAgICAgIGFjdHVhbFZhbHVlLmZvckVhY2goKHZhbHVlOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRmxhdC5maW5kKChvcHRpb246IE5neFNlbGVjdE9wdGlvbikgPT4gb3B0aW9uLnZhbHVlID09PSB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZE9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1NlbGVjdGVkLnB1c2goc2VsZWN0ZWRPcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5rZWVwU2VsZWN0ZWRJdGVtcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb25WYWx1ZXMgPSBvcHRpb25zU2VsZWN0ZWQubWFwKChvcHRpb246IE5neFNlbGVjdE9wdGlvbikgPT4gb3B0aW9uLnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qga2VwdFNlbGVjdGVkT3B0aW9ucyA9IHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC52YWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbHRlcigoc2VsT3B0aW9uOiBOZ3hTZWxlY3RPcHRpb24pID0+IG9wdGlvblZhbHVlcy5pbmRleE9mKHNlbE9wdGlvbi52YWx1ZSkgPT09IC0xKTtcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uc1NlbGVjdGVkLnB1c2goLi4ua2VwdFNlbGVjdGVkT3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKCFfLmlzRXF1YWwob3B0aW9uc1NlbGVjdGVkLCB0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC5uZXh0KG9wdGlvbnNTZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICApLnN1YnNjcmliZSgpO1xuXG4gICAgICAgIC8vIEVuc3VyZSB3b3JraW5nIGZpbHRlciBieSBhIHNlYXJjaCB0ZXh0XG4gICAgICAgIGNvbWJpbmVMYXRlc3QodGhpcy5zdWJqT3B0aW9ucywgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLCB0aGlzLnN1YmpTZWFyY2hUZXh0KS5waXBlKFxuICAgICAgICAgICAgbWFwKChbb3B0aW9ucywgc2VsZWN0ZWRPcHRpb25zLCBzZWFyY2hdOiBbVFNlbGVjdE9wdGlvbltdLCBOZ3hTZWxlY3RPcHRpb25bXSwgc3RyaW5nXSkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uc0ZpbHRlcmVkID0gdGhpcy5maWx0ZXJPcHRpb25zKHNlYXJjaCwgb3B0aW9ucywgc2VsZWN0ZWRPcHRpb25zKS5tYXAob3B0aW9uID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbiBpbnN0YW5jZW9mIE5neFNlbGVjdE9wdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uLmhpZ2hsaWdodGVkVGV4dCA9IHRoaXMuaGlnaGxpZ2h0T3B0aW9uKG9wdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0R3JvdXApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbi5vcHRpb25zLm1hcChzdWJPcHRpb24gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Yk9wdGlvbi5oaWdobGlnaHRlZFRleHQgPSB0aGlzLmhpZ2hsaWdodE9wdGlvbihzdWJPcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzdWJPcHRpb247XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3B0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMuY2FjaGVPcHRpb25zRmlsdGVyZWRGbGF0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlT3B0aW9uKEVOYXZpZ2F0aW9uLmZpcnN0SWZPcHRpb25BY3RpdmVJbnZpc2libGUpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkT3B0aW9ucztcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgZmxhdE1hcCgoc2VsZWN0ZWRPcHRpb25zOiBOZ3hTZWxlY3RPcHRpb25bXSkgPT4gdGhpcy5vcHRpb25zRmlsdGVyZWRGbGF0KCkucGlwZShmaWx0ZXIoXG4gICAgICAgICAgICAgICAgKGZsYXRPcHRpb25zOiBOZ3hTZWxlY3RPcHRpb25bXSkgPT4gdGhpcy5hdXRvU2VsZWN0U2luZ2xlT3B0aW9uICYmIGZsYXRPcHRpb25zLmxlbmd0aCA9PT0gMSAmJiAhc2VsZWN0ZWRPcHRpb25zLmxlbmd0aFxuICAgICAgICAgICAgKSkpXG4gICAgICAgICkuc3Vic2NyaWJlKChmbGF0T3B0aW9uczogTmd4U2VsZWN0T3B0aW9uW10pID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC5uZXh0KGZsYXRPcHRpb25zKTtcbiAgICAgICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRGb3JtQ29udHJvbFNpemUob3RoZXJDbGFzc05hbWVzOiBvYmplY3QgPSB7fSwgdXNlRm9ybUNvbnRyb2w6IGJvb2xlYW4gPSB0cnVlKSB7XG4gICAgICAgIGNvbnN0IGZvcm1Db250cm9sRXh0cmFDbGFzc2VzID0gdXNlRm9ybUNvbnRyb2wgPyB7XG4gICAgICAgICAgICAnZm9ybS1jb250cm9sLXNtIGlucHV0LXNtJzogdGhpcy5zaXplID09PSAnc21hbGwnLFxuICAgICAgICAgICAgJ2Zvcm0tY29udHJvbC1sZyBpbnB1dC1sZyc6IHRoaXMuc2l6ZSA9PT0gJ2xhcmdlJ1xuICAgICAgICB9IDoge307XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGZvcm1Db250cm9sRXh0cmFDbGFzc2VzLCBvdGhlckNsYXNzTmFtZXMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXRCdG5TaXplKCkge1xuICAgICAgICByZXR1cm4geydidG4tc20nOiB0aGlzLnNpemUgPT09ICdzbWFsbCcsICdidG4tbGcnOiB0aGlzLnNpemUgPT09ICdsYXJnZSd9O1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgb3B0aW9uc1NlbGVjdGVkKCk6IE5neFNlbGVjdE9wdGlvbltdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC52YWx1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbWFpbkNsaWNrZWQoZXZlbnQ6IElOZ3hTZWxlY3RDb21wb25lbnRNb3VzZUV2ZW50KSB7XG4gICAgICAgIGV2ZW50LmNsaWNrZWRTZWxlY3RDb21wb25lbnQgPSB0aGlzO1xuICAgICAgICBpZiAoIXRoaXMuaXNGb2N1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLmlzRm9jdXNlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLmZvY3VzLmVtaXQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmZvY3VzaW4nLCBbJyRldmVudCddKVxuICAgIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmNsaWNrJywgWyckZXZlbnQnXSlcbiAgICBwdWJsaWMgZG9jdW1lbnRDbGljayhldmVudDogSU5neFNlbGVjdENvbXBvbmVudE1vdXNlRXZlbnQpIHtcbiAgICAgICAgaWYgKGV2ZW50LmNsaWNrZWRTZWxlY3RDb21wb25lbnQgIT09IHRoaXMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnNPcGVuZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNDbG9zZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpOyAvLyBmaXggZXJyb3IgYmVjYXVzZSBvZiBkZWxheSBiZXR3ZWVuIGRpZmZlcmVudCBldmVudHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNGb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5ibHVyLmVtaXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgb3B0aW9uc0ZpbHRlcmVkRmxhdCgpOiBPYnNlcnZhYmxlPE5neFNlbGVjdE9wdGlvbltdPiB7XG4gICAgICAgIGlmICh0aGlzLmNhY2hlT3B0aW9uc0ZpbHRlcmVkRmxhdCkge1xuICAgICAgICAgICAgcmV0dXJuIG9mKHRoaXMuY2FjaGVPcHRpb25zRmlsdGVyZWRGbGF0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmcm9tKHRoaXMub3B0aW9uc0ZpbHRlcmVkKS5waXBlKFxuICAgICAgICAgICAgZmxhdE1hcDxUU2VsZWN0T3B0aW9uLCBhbnk+KChvcHRpb246IFRTZWxlY3RPcHRpb24pID0+XG4gICAgICAgICAgICAgICAgb3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0aW9uID8gb2Yob3B0aW9uKSA6XG4gICAgICAgICAgICAgICAgICAgIChvcHRpb24gaW5zdGFuY2VvZiBOZ3hTZWxlY3RPcHRHcm91cCA/IGZyb20ob3B0aW9uLm9wdGlvbnNGaWx0ZXJlZCkgOiBFTVBUWSlcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICBmaWx0ZXIoKG9wdGlvbnNGaWx0ZXJlZEZsYXQ6IE5neFNlbGVjdE9wdGlvbikgPT4gIW9wdGlvbnNGaWx0ZXJlZEZsYXQuZGlzYWJsZWQpLFxuICAgICAgICAgICAgdG9BcnJheSgpLFxuICAgICAgICAgICAgdGFwKChvcHRpb25zRmlsdGVyZWRGbGF0OiBOZ3hTZWxlY3RPcHRpb25bXSkgPT4gdGhpcy5jYWNoZU9wdGlvbnNGaWx0ZXJlZEZsYXQgPSBvcHRpb25zRmlsdGVyZWRGbGF0KVxuICAgICAgICApO1xuICAgIH1cblxuICAgIHByaXZhdGUgbmF2aWdhdGVPcHRpb24obmF2aWdhdGlvbjogRU5hdmlnYXRpb24pIHtcbiAgICAgICAgdGhpcy5vcHRpb25zRmlsdGVyZWRGbGF0KCkucGlwZShcbiAgICAgICAgICAgIG1hcDxOZ3hTZWxlY3RPcHRpb25bXSwgSU5neE9wdGlvbk5hdmlnYXRlZD4oKG9wdGlvbnM6IE5neFNlbGVjdE9wdGlvbltdKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmF2aWdhdGVkOiBJTmd4T3B0aW9uTmF2aWdhdGVkID0ge2luZGV4OiAtMSwgYWN0aXZlT3B0aW9uOiBudWxsLCBmaWx0ZXJlZE9wdGlvbkxpc3Q6IG9wdGlvbnN9O1xuICAgICAgICAgICAgICAgIGxldCBuZXdBY3RpdmVJZHg7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChuYXZpZ2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRU5hdmlnYXRpb24uZmlyc3Q6XG4gICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZWQuaW5kZXggPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRU5hdmlnYXRpb24ucHJldmlvdXM6XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdBY3RpdmVJZHggPSBvcHRpb25zLmluZGV4T2YodGhpcy5vcHRpb25BY3RpdmUpIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlZC5pbmRleCA9IG5ld0FjdGl2ZUlkeCA+PSAwID8gbmV3QWN0aXZlSWR4IDogb3B0aW9ucy5sZW5ndGggLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRU5hdmlnYXRpb24ubmV4dDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FjdGl2ZUlkeCA9IG9wdGlvbnMuaW5kZXhPZih0aGlzLm9wdGlvbkFjdGl2ZSkgKyAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGVkLmluZGV4ID0gbmV3QWN0aXZlSWR4IDwgb3B0aW9ucy5sZW5ndGggPyBuZXdBY3RpdmVJZHggOiAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRU5hdmlnYXRpb24ubGFzdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlZC5pbmRleCA9IG9wdGlvbnMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIEVOYXZpZ2F0aW9uLmZpcnN0U2VsZWN0ZWQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnZhbHVlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlZC5pbmRleCA9IG9wdGlvbnMuaW5kZXhPZih0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWVbMF0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgRU5hdmlnYXRpb24uZmlyc3RJZk9wdGlvbkFjdGl2ZUludmlzaWJsZTpcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBpZHhPZk9wdGlvbkFjdGl2ZSA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9uQWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWR4T2ZPcHRpb25BY3RpdmUgPSBvcHRpb25zLmluZGV4T2Yob3B0aW9ucy5maW5kKHggPT4geC52YWx1ZSA9PT0gdGhpcy5vcHRpb25BY3RpdmUudmFsdWUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlZC5pbmRleCA9IGlkeE9mT3B0aW9uQWN0aXZlID4gMCA/IGlkeE9mT3B0aW9uQWN0aXZlIDogMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuYXZpZ2F0ZWQuYWN0aXZlT3B0aW9uID0gb3B0aW9uc1tuYXZpZ2F0ZWQuaW5kZXhdO1xuICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0ZWQ7XG4gICAgICAgICAgICB9KVxuICAgICAgICApLnN1YnNjcmliZSgobmV3TmF2aWdhdGVkOiBJTmd4T3B0aW9uTmF2aWdhdGVkKSA9PiB0aGlzLm9wdGlvbkFjdGl2YXRlKG5ld05hdmlnYXRlZCkpO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZ0RvQ2hlY2soKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLml0ZW1zRGlmZmVyLmRpZmYodGhpcy5pdGVtcykpIHtcbiAgICAgICAgICAgIHRoaXMuc3Viak9wdGlvbnMubmV4dCh0aGlzLmJ1aWxkT3B0aW9ucyh0aGlzLml0ZW1zKSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkZWZWYWwgPSB0aGlzLmRlZmF1bHRWYWx1ZSA/IFtdLmNvbmNhdCh0aGlzLmRlZmF1bHRWYWx1ZSkgOiBbXTtcbiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdFZhbHVlRGlmZmVyLmRpZmYoZGVmVmFsKSkge1xuICAgICAgICAgICAgdGhpcy5zdWJqRGVmYXVsdFZhbHVlLm5leHQoZGVmVmFsKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBuZ0FmdGVyQ29udGVudENoZWNrZWQoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLl9mb2N1c1RvSW5wdXQgJiYgdGhpcy5jaGVja0lucHV0VmlzaWJpbGl0eSgpICYmIHRoaXMuaW5wdXRFbFJlZiAmJlxuICAgICAgICAgICAgdGhpcy5pbnB1dEVsUmVmLm5hdGl2ZUVsZW1lbnQgIT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZvY3VzVG9JbnB1dCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5pbnB1dEVsUmVmLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmNob2ljZU1lbnVFbFJlZikge1xuICAgICAgICAgICAgY29uc3QgdWxFbGVtZW50ID0gdGhpcy5jaG9pY2VNZW51RWxSZWYubmF0aXZlRWxlbWVudCBhcyBIVE1MVUxpc3RFbGVtZW50O1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHVsRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdhLm5neC1zZWxlY3RfX2l0ZW1fYWN0aXZlLmFjdGl2ZScpIGFzIEhUTUxMaW5rRWxlbWVudDtcblxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5vZmZzZXRIZWlnaHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnN1cmVWaXNpYmxlRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgICAgICB0aGlzLmNkLmRldGFjaCgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBjYW5DbGVhck5vdE11bHRpcGxlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5hbGxvd0NsZWFyICYmICEhdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnZhbHVlLmxlbmd0aCAmJlxuICAgICAgICAgICAgKCF0aGlzLnN1YmpEZWZhdWx0VmFsdWUudmFsdWUubGVuZ3RoIHx8IHRoaXMuc3ViakRlZmF1bHRWYWx1ZS52YWx1ZVswXSAhPT0gdGhpcy5hY3R1YWxWYWx1ZVswXSk7XG4gICAgfVxuXG4gICAgcHVibGljIGZvY3VzVG9JbnB1dCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fZm9jdXNUb0lucHV0ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5wdXRLZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGtleXNGb3JPcGVuZWRTdGF0ZSA9IFtdLmNvbmNhdChcbiAgICAgICAgICAgIHRoaXMua2V5Q29kZVRvT3B0aW9uc1NlbGVjdCxcbiAgICAgICAgICAgIHRoaXMua2V5Q29kZVRvTmF2aWdhdGVGaXJzdCxcbiAgICAgICAgICAgIHRoaXMua2V5Q29kZVRvTmF2aWdhdGVQcmV2aW91cyxcbiAgICAgICAgICAgIHRoaXMua2V5Q29kZVRvTmF2aWdhdGVOZXh0LFxuICAgICAgICAgICAgdGhpcy5rZXlDb2RlVG9OYXZpZ2F0ZUxhc3RcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3Qga2V5c0ZvckNsb3NlZFN0YXRlID0gW10uY29uY2F0KHRoaXMua2V5Q29kZVRvT3B0aW9uc09wZW4sIHRoaXMua2V5Q29kZVRvUmVtb3ZlU2VsZWN0ZWQpO1xuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnNPcGVuZWQgJiYga2V5c0Zvck9wZW5lZFN0YXRlLmluZGV4T2YoZXZlbnQuY29kZSkgIT09IC0xKSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIChbXS5jb25jYXQodGhpcy5rZXlDb2RlVG9PcHRpb25zU2VsZWN0KS5pbmRleE9mKGV2ZW50LmNvZGUpICsgMSkgJiYgZXZlbnQuY29kZTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25TZWxlY3QodGhpcy5vcHRpb25BY3RpdmUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlT3B0aW9uKEVOYXZpZ2F0aW9uLm5leHQpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMua2V5Q29kZVRvTmF2aWdhdGVGaXJzdDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZU9wdGlvbihFTmF2aWdhdGlvbi5maXJzdCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgdGhpcy5rZXlDb2RlVG9OYXZpZ2F0ZVByZXZpb3VzOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRlT3B0aW9uKEVOYXZpZ2F0aW9uLnByZXZpb3VzKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLmtleUNvZGVUb05hdmlnYXRlTGFzdDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZU9wdGlvbihFTmF2aWdhdGlvbi5sYXN0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSB0aGlzLmtleUNvZGVUb05hdmlnYXRlTmV4dDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uYXZpZ2F0ZU9wdGlvbihFTmF2aWdhdGlvbi5uZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMub3B0aW9uc09wZW5lZCAmJiBrZXlzRm9yQ2xvc2VkU3RhdGUuaW5kZXhPZihldmVudC5jb2RlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQuY29kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgKFtdLmNvbmNhdCh0aGlzLmtleUNvZGVUb09wdGlvbnNPcGVuKS5pbmRleE9mKGV2ZW50LmNvZGUpICsgMSkgJiYgZXZlbnQuY29kZTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zT3BlbigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIHRoaXMua2V5Q29kZVRvUmVtb3ZlU2VsZWN0ZWQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uUmVtb3ZlKHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC52YWx1ZVt0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUubGVuZ3RoIC0gMV0sIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgdHJhY2tCeU9wdGlvbihpbmRleDogbnVtYmVyLCBvcHRpb246IFRTZWxlY3RPcHRpb24pIHtcbiAgICAgICAgcmV0dXJuIG9wdGlvbiBpbnN0YW5jZW9mIE5neFNlbGVjdE9wdGlvbiA/IG9wdGlvbi52YWx1ZSA6XG4gICAgICAgICAgICAob3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0R3JvdXAgPyBvcHRpb24ubGFiZWwgOiBvcHRpb24pO1xuICAgIH1cblxuICAgIHB1YmxpYyBjaGVja0lucHV0VmlzaWJpbGl0eSgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLm11bHRpcGxlID09PSB0cnVlKSB8fCAodGhpcy5vcHRpb25zT3BlbmVkICYmICF0aGlzLm5vQXV0b0NvbXBsZXRlKTtcbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIGlucHV0S2V5VXAodmFsdWU6IHN0cmluZyA9ICcnLCBldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuY29kZSA9PT0gdGhpcy5rZXlDb2RlVG9PcHRpb25zQ2xvc2UpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9uc0Nsb3NlKC8qdHJ1ZSovKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnNPcGVuZWQgJiYgKFsnQXJyb3dEb3duJywgJ0Fycm93VXAnLCAnQXJyb3dMZWZ0JywgJ0Fycm93RG93biddLmluZGV4T2YoZXZlbnQuY29kZSkgPT09IC0xKS8qaWdub3JlIGFycm93cyovKSB7XG4gICAgICAgICAgICB0aGlzLnR5cGVkLmVtaXQodmFsdWUpO1xuICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLm9wdGlvbnNPcGVuZWQgJiYgdmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMub3B0aW9uc09wZW4odmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBpbnB1dENsaWNrKHZhbHVlOiBzdHJpbmcgPSAnJykge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9uc09wZW5lZCkge1xuICAgICAgICAgICAgdGhpcy5vcHRpb25zT3Blbih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiogQGludGVybmFsICovXG4gICAgcHVibGljIHNhbml0aXplKGh0bWw6IHN0cmluZyk6IFNhZmVIdG1sIHtcbiAgICAgICAgcmV0dXJuIGh0bWwgPyB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0SHRtbChodG1sKSA6IG51bGw7XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBoaWdobGlnaHRPcHRpb24ob3B0aW9uOiBOZ3hTZWxlY3RPcHRpb24pOiBTYWZlSHRtbCB7XG4gICAgICAgIGlmICh0aGlzLmlucHV0RWxSZWYpIHtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb24ucmVuZGVyVGV4dCh0aGlzLnNhbml0aXplciwgdGhpcy5pbnB1dEVsUmVmLm5hdGl2ZUVsZW1lbnQudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcHRpb24ucmVuZGVyVGV4dCh0aGlzLnNhbml0aXplciwgJycpO1xuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgb3B0aW9uU2VsZWN0KG9wdGlvbjogTmd4U2VsZWN0T3B0aW9uLCBldmVudDogRXZlbnQgPSBudWxsKTogdm9pZCB7XG4gICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb24gJiYgIW9wdGlvbi5kaXNhYmxlZCkge1xuICAgICAgICAgICAgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLm5leHQoKHRoaXMubXVsdGlwbGUgPyB0aGlzLnN1YmpPcHRpb25zU2VsZWN0ZWQudmFsdWUgOiBbXSkuY29uY2F0KFtvcHRpb25dKSk7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdC5lbWl0KG9wdGlvbi52YWx1ZSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMua2VlcFNlbGVjdE1lbnVPcGVuZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNDbG9zZSgvKnRydWUqLyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm9uVG91Y2hlZCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBvcHRpb25SZW1vdmUob3B0aW9uOiBOZ3hTZWxlY3RPcHRpb24sIGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQgJiYgb3B0aW9uKSB7XG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIHRoaXMuc3Viak9wdGlvbnNTZWxlY3RlZC5uZXh0KCh0aGlzLm11bHRpcGxlID8gdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnZhbHVlIDogW10pLmZpbHRlcihvID0+IG8gIT09IG9wdGlvbikpO1xuICAgICAgICAgICAgdGhpcy5yZW1vdmUuZW1pdChvcHRpb24udmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBvcHRpb25BY3RpdmF0ZShuYXZpZ2F0ZWQ6IElOZ3hPcHRpb25OYXZpZ2F0ZWQpOiB2b2lkIHtcbiAgICAgICAgaWYgKCh0aGlzLm9wdGlvbkFjdGl2ZSAhPT0gbmF2aWdhdGVkLmFjdGl2ZU9wdGlvbikgJiZcbiAgICAgICAgICAgICghbmF2aWdhdGVkLmFjdGl2ZU9wdGlvbiB8fCAhbmF2aWdhdGVkLmFjdGl2ZU9wdGlvbi5kaXNhYmxlZCkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbkFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uQWN0aXZlLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLm9wdGlvbkFjdGl2ZSA9IG5hdmlnYXRlZC5hY3RpdmVPcHRpb247XG5cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbkFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMub3B0aW9uQWN0aXZlLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRlZC5lbWl0KG5hdmlnYXRlZCk7XG4gICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBwdWJsaWMgb25Nb3VzZUVudGVyKG5hdmlnYXRlZDogSU5neE9wdGlvbk5hdmlnYXRlZCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5hdXRvQWN0aXZlT25Nb3VzZUVudGVyKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbkFjdGl2YXRlKG5hdmlnYXRlZCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbHRlck9wdGlvbnMoc2VhcmNoOiBzdHJpbmcsIG9wdGlvbnM6IFRTZWxlY3RPcHRpb25bXSwgc2VsZWN0ZWRPcHRpb25zOiBOZ3hTZWxlY3RPcHRpb25bXSk6IFRTZWxlY3RPcHRpb25bXSB7XG4gICAgICAgIGNvbnN0IHJlZ0V4cCA9IG5ldyBSZWdFeHAoZXNjYXBlU3RyaW5nKHNlYXJjaCksICdpJyksXG4gICAgICAgICAgICBmaWx0ZXJPcHRpb24gPSAob3B0aW9uOiBOZ3hTZWxlY3RPcHRpb24pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWFyY2hDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zZWFyY2hDYWxsYmFjayhzZWFyY2gsIG9wdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiAoIXNlYXJjaCB8fCByZWdFeHAudGVzdChvcHRpb24udGV4dCkpICYmICghdGhpcy5tdWx0aXBsZSB8fCBzZWxlY3RlZE9wdGlvbnMuaW5kZXhPZihvcHRpb24pID09PSAtMSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBvcHRpb25zLmZpbHRlcigob3B0aW9uOiBUU2VsZWN0T3B0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAob3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlck9wdGlvbihvcHRpb24gYXMgTmd4U2VsZWN0T3B0aW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9uIGluc3RhbmNlb2YgTmd4U2VsZWN0T3B0R3JvdXApIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdWJPcCA9IG9wdGlvbiBhcyBOZ3hTZWxlY3RPcHRHcm91cDtcbiAgICAgICAgICAgICAgICBzdWJPcC5maWx0ZXIoKHN1Yk9wdGlvbjogTmd4U2VsZWN0T3B0aW9uKSA9PiBmaWx0ZXJPcHRpb24oc3ViT3B0aW9uKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Yk9wLm9wdGlvbnNGaWx0ZXJlZC5sZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZW5zdXJlVmlzaWJsZUVsZW1lbnQoZWxlbWVudDogSFRNTEVsZW1lbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuY2hvaWNlTWVudUVsUmVmICYmIHRoaXMuY2FjaGVFbGVtZW50T2Zmc2V0VG9wICE9PSBlbGVtZW50Lm9mZnNldFRvcCkge1xuICAgICAgICAgICAgdGhpcy5jYWNoZUVsZW1lbnRPZmZzZXRUb3AgPSBlbGVtZW50Lm9mZnNldFRvcDtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lcjogSFRNTEVsZW1lbnQgPSB0aGlzLmNob2ljZU1lbnVFbFJlZi5uYXRpdmVFbGVtZW50O1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FjaGVFbGVtZW50T2Zmc2V0VG9wIDwgY29udGFpbmVyLnNjcm9sbFRvcCkge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSB0aGlzLmNhY2hlRWxlbWVudE9mZnNldFRvcDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5jYWNoZUVsZW1lbnRPZmZzZXRUb3AgKyBlbGVtZW50Lm9mZnNldEhlaWdodCA+IGNvbnRhaW5lci5zY3JvbGxUb3AgKyBjb250YWluZXIuY2xpZW50SGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IHRoaXMuY2FjaGVFbGVtZW50T2Zmc2V0VG9wICsgZWxlbWVudC5vZmZzZXRIZWlnaHQgLSBjb250YWluZXIuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHNob3dDaG9pY2VNZW51KCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zT3BlbmVkICYmICghIXRoaXMuc3Viak9wdGlvbnMudmFsdWUubGVuZ3RoIHx8IHRoaXMuc2hvd09wdGlvbk5vdEZvdW5kRm9yRW1wdHlJdGVtcyk7XG4gICAgfVxuXG4gICAgcHVibGljIG9wdGlvbnNPcGVuKHNlYXJjaDogc3RyaW5nID0gJycpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLm9wdGlvbnNPcGVuZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zdWJqU2VhcmNoVGV4dC5uZXh0KHNlYXJjaCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMubXVsdGlwbGUgJiYgdGhpcy5zdWJqT3B0aW9uc1NlbGVjdGVkLnZhbHVlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVPcHRpb24oRU5hdmlnYXRpb24uZmlyc3RTZWxlY3RlZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubmF2aWdhdGVPcHRpb24oRU5hdmlnYXRpb24uZmlyc3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5mb2N1c1RvSW5wdXQoKTtcbiAgICAgICAgICAgIHRoaXMub3Blbi5lbWl0KCk7XG4gICAgICAgICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIG9wdGlvbnNDbG9zZSgvKmZvY3VzVG9Ib3N0OiBib29sZWFuID0gZmFsc2UqLykge1xuICAgICAgICB0aGlzLm9wdGlvbnNPcGVuZWQgPSBmYWxzZTtcbiAgICAgICAgLy8gaWYgKGZvY3VzVG9Ib3N0KSB7XG4gICAgICAgIC8vICAgICBjb25zdCB4ID0gd2luZG93LnNjcm9sbFgsIHkgPSB3aW5kb3cuc2Nyb2xsWTtcbiAgICAgICAgLy8gICAgIHRoaXMubWFpbkVsUmVmLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgLy8gICAgIHdpbmRvdy5zY3JvbGxUbyh4LCB5KTtcbiAgICAgICAgLy8gfVxuICAgICAgICB0aGlzLmNsb3NlLmVtaXQoKTtcblxuICAgICAgICBpZiAodGhpcy5hdXRvQ2xlYXJTZWFyY2ggJiYgdGhpcy5tdWx0aXBsZSAmJiB0aGlzLmlucHV0RWxSZWYpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRFbFJlZi5uYXRpdmVFbGVtZW50LnZhbHVlID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGRPcHRpb25zKGRhdGE6IGFueVtdKTogQXJyYXk8Tmd4U2VsZWN0T3B0aW9uIHwgTmd4U2VsZWN0T3B0R3JvdXA+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0OiBBcnJheTxOZ3hTZWxlY3RPcHRpb24gfCBOZ3hTZWxlY3RPcHRHcm91cD4gPSBbXTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgoaXRlbTogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNPcHRHcm91cCA9IHR5cGVvZiBpdGVtID09PSAnb2JqZWN0JyAmJiBpdGVtICE9PSBudWxsICYmXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5RXhpc3RzKGl0ZW0sIHRoaXMub3B0R3JvdXBMYWJlbEZpZWxkKSAmJiBwcm9wZXJ0eUV4aXN0cyhpdGVtLCB0aGlzLm9wdEdyb3VwT3B0aW9uc0ZpZWxkKSAmJlxuICAgICAgICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KGl0ZW1bdGhpcy5vcHRHcm91cE9wdGlvbnNGaWVsZF0pO1xuICAgICAgICAgICAgICAgIGlmIChpc09wdEdyb3VwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdEdyb3VwID0gbmV3IE5neFNlbGVjdE9wdEdyb3VwKGl0ZW1bdGhpcy5vcHRHcm91cExhYmVsRmllbGRdKTtcbiAgICAgICAgICAgICAgICAgICAgaXRlbVt0aGlzLm9wdEdyb3VwT3B0aW9uc0ZpZWxkXS5mb3JFYWNoKChzdWJPcHRpb246IE5neFNlbGVjdE9wdGlvbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3B0ID0gdGhpcy5idWlsZE9wdGlvbihzdWJPcHRpb24sIG9wdEdyb3VwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRHcm91cC5vcHRpb25zLnB1c2gob3B0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKG9wdEdyb3VwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvcHRpb24gPSB0aGlzLmJ1aWxkT3B0aW9uKGl0ZW0sIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChvcHRpb24pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGJ1aWxkT3B0aW9uKGRhdGE6IGFueSwgcGFyZW50OiBOZ3hTZWxlY3RPcHRHcm91cCk6IE5neFNlbGVjdE9wdGlvbiB7XG4gICAgICAgIGxldCB2YWx1ZSwgdGV4dCwgZGlzYWJsZWQ7XG4gICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGRhdGEgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHRleHQgPSBkYXRhO1xuICAgICAgICAgICAgZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGF0YSA9PT0gJ29iamVjdCcgJiYgZGF0YSAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgKHByb3BlcnR5RXhpc3RzKGRhdGEsIHRoaXMub3B0aW9uVmFsdWVGaWVsZCkgfHwgcHJvcGVydHlFeGlzdHMoZGF0YSwgdGhpcy5vcHRpb25UZXh0RmllbGQpKSkge1xuICAgICAgICAgICAgdmFsdWUgPSBwcm9wZXJ0eUV4aXN0cyhkYXRhLCB0aGlzLm9wdGlvblZhbHVlRmllbGQpID8gZGF0YVt0aGlzLm9wdGlvblZhbHVlRmllbGRdIDogZGF0YVt0aGlzLm9wdGlvblRleHRGaWVsZF07XG4gICAgICAgICAgICB0ZXh0ID0gcHJvcGVydHlFeGlzdHMoZGF0YSwgdGhpcy5vcHRpb25UZXh0RmllbGQpID8gZGF0YVt0aGlzLm9wdGlvblRleHRGaWVsZF0gOiBkYXRhW3RoaXMub3B0aW9uVmFsdWVGaWVsZF07XG4gICAgICAgICAgICBkaXNhYmxlZCA9IHByb3BlcnR5RXhpc3RzKGRhdGEsICdkaXNhYmxlZCcpID8gZGF0YVsnZGlzYWJsZWQnXSA6IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBOZ3hTZWxlY3RPcHRpb24odmFsdWUsIHRleHQsIGRpc2FibGVkLCBkYXRhLCBwYXJlbnQpO1xuICAgIH1cblxuICAgIC8vLy8vLy8vLy8vLyBpbnRlcmZhY2UgQ29udHJvbFZhbHVlQWNjZXNzb3IgLy8vLy8vLy8vLy8vXG4gICAgcHVibGljIG9uQ2hhbmdlID0gKHY6IGFueSkgPT4gdjtcblxuICAgIHB1YmxpYyBvblRvdWNoZWQ6ICgpID0+IHZvaWQgPSAoKSA9PiBudWxsO1xuXG4gICAgcHVibGljIHdyaXRlVmFsdWUob2JqOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5zdWJqRXh0ZXJuYWxWYWx1ZS5uZXh0KG9iaik7XG4gICAgfVxuXG4gICAgcHVibGljIHJlZ2lzdGVyT25DaGFuZ2UoZm46IChfOiBhbnkpID0+IHt9KTogdm9pZCB7XG4gICAgICAgIHRoaXMub25DaGFuZ2UgPSBmbjtcbiAgICAgICAgdGhpcy5zdWJqUmVnaXN0ZXJPbkNoYW5nZS5uZXh0KCk7XG4gICAgfVxuXG4gICAgcHVibGljIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiAoKSA9PiB7fSk6IHZvaWQge1xuICAgICAgICB0aGlzLm9uVG91Y2hlZCA9IGZuO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gICAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfVxufVxuIl19